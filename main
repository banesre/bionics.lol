import threading
import time
import sys
import os
os.environ['PYGAME_HIDE_SUPPORT_PROMPT'] = "1"
import pygame
import numpy as np
import win32api
from ctypes import windll, Structure, wintypes
import ctypes
from numpy import array, float32, linalg
import dearpygui.dearpygui as dpg
from requests import get
from pymem import Pymem
from pymem.process import list_processes
from psutil import pid_exists
import json
import math
from PyQt5.QtGui import QColor, QBrush, QPainter
from PyQt5.QtCore import Qt, QTimer, QObject, pyqtSignal
from PyQt5.QtWidgets import QApplication, QWidget
import random
from OpenGL.GL import *
import platform
import requests
import re
import win32con
import hashlib
try:
    from keyauth.api import Keyauth
except ImportError:
    print("Error: Could not import Keyauth. Make sure it is installed (pip install keyauth).")
    Keyauth = None

def getchecksum():
    md5_hash = hashlib.md5()
    try:
        with open(sys.argv[0], "rb") as f:
            md5_hash.update(f.read())
        return md5_hash.hexdigest()
    except:
        return ""

keyauthapp = None
if Keyauth:
    try:
        keyauthapp = Keyauth(
            name="element.cc",
            owner_id="RbxQwRgQVs",
            secret="755a1838693373bd8fe248cb4634aa99caf89b117b2243c697fdc57973b07cab",
            version="1.0",
            file_hash=getchecksum()
        )
    except Exception as e:
        print(f"KeyAuth Initialization Failed: {e}")


def check_windows_version():
    if platform.system() != "Windows":
        return "Not Windows"
    release = platform.release()
    if release == "10":
        build = int(platform.version().split(".")[2])
        if build >= 22000:
            return "Windows 11"
        else:
            return "Windows 10"
    elif release == "11":
        return "Windows 11"
    else:
        return f"Windows {release}"
v = check_windows_version()
swidth = win32api.GetSystemMetrics(0)
sheight = win32api.GetSystemMetrics(1)
DEFAULT_GUI_WIDTH = 1300
DEFAULT_GUI_HEIGHT = 900
os.system("title Py1337 - Login")
theme = "v3"
def get_default_config_path2():
    home_dir = os.path.expanduser('~')
    return os.path.join(home_dir, ".py1337config", "login.json")
def get_configs_directory2():
    filepath = get_default_config_path2()
    config_dir = os.path.dirname(filepath)
    os.makedirs(config_dir, exist_ok=True)
    return config_dir
def is_logged_in():
    filepath = get_default_config_path2()
    if not os.path.exists(filepath):
        return False
    try:
        with open(filepath, 'r') as f:
            config = json.load(f)
            return config.get('logged_in', False)
    except (FileNotFoundError, json.JSONDecodeError, Exception) as e:
        print(f"Warning: Could not read or parse login config. Assuming not logged in. Error: {e}")
        return False
def set_logged_in(status: bool):
    get_configs_directory2()
    filepath = get_default_config_path2()
    config_data = {"logged_in": status}
    try:
        with open(filepath, 'w') as f:
            json.dump(config_data, f, indent=4)
    except Exception as e:
        print(f"Error: Could not write login configuration to file. {e}")
os.system("cls")
PID = -1
baseAddr = None
pm = Pymem()
fovfill = False
fovglow = False
aimbot_enabled = False
aimbot_keybind = 'Right Mouse'
shape = "circle"
Humanization_enabled = False
waiting_for_keybind = False
injected = False
aimbot_smoothness_enabled = False
aimbot_smoothness_value = 1
aimbot_ignoreteam = False
aimbot_ignoredead = False
aimbot_hitpart = "Head"
aimbot_type = "Mouse"
aimbot_prediction_enabled = False
aimbot_prediction_x = 0.0
speed_enabled = False
aimbot_prediction_y = 0.0
triggerbot_keybind = 'Delete'
aimbot_fov = 160 * 2
opamount = 255
fovtoggle = False
speed = 20.0
keybind_bg_color = [35, 35, 45]
keybind_line_color = [180, 100, 255]
keybind_text_color = [220, 220, 230]
fovoutline = False
fovglowamount = 10
lockedplr = 0
dataModel = 0
wsAddr = 0
camAddr = 0
fly_keybind = 81
speed_keybind = 45
oldfov = 0
camCFrameRotAddr = 0
plrsAddr = 0
lpAddr = 0
matrixAddr = 0
camPosAddr = 0
target = 0
nameOffset = 0
childrenOffset = 0
joystick = None
# Triggerbot & Streamproof Globals
triggerbot_enabled = False
triggerbot_shoot_key = 0x12 # VK_MENU (Alt)
triggerbot_delay_reaction = 0.0
triggerbot_delay_shot = 0.0
streamproof_enabled = False
global_esp_thickness = 1
waiting_for_triggerbot_key = False

# Silent Aim Globals
silent_aim_enabled = False
silent_aim_key = 0x58 # X key default
silent_aim_fov = 100
silent_aim_hitchance = 100
silent_aim_smart = False # Prediction
silent_aim_prediction_x = 0.0

# World Editor Globals (v3)
world_time_enabled = False
world_time_value = 14.0
world_fog_enabled = False
world_fog_start = 0.0
world_fog_end = 1000.0
world_fog_color = [128, 128, 128]
world_ambient_enabled = False
world_ambient_color = [128, 128, 128]
world_gravity_enabled = False
world_gravity_value = 196.2
world_infinite_zoom = False
world_fov_enabled = False
world_fov_value = 70.0
world_disco_fog = False
world_black_sky = False
world_exposure_enabled = False
world_exposure_value = 0.0

# Extras Globals (Da Hood)
extra_noclip = False
extra_float = False
extra_spam_e = False

# Map cleanup flags
delete_doors_flag = False
delete_seats_flag = False
delete_trees_flag = False

# UI visibility (toggled by key)
ui_visible = True
last_toggle_time = 0
toggle_debounce_delay = 0.2

silent_aim_prediction_y = 0.0
silent_aim_target = None
waiting_for_silent_aim_key = False
rapid_fire_key = None
waiting_for_rapid_fire_key = False

# FOV Changer Globals
fov_changer_enabled = False
fov_changer_value = 70

# Chams Globals
chams_enabled = False
chams_color = [255, 0, 0] # Red default
chams_type = "Solid" # Solid, Glow, Matte


VK_CODES = {
    'Left Mouse': 0x01, 'Right Mouse': 0x02, 'Middle Mouse': 0x04, 'X1 Mouse': 0x05, 'X2 Mouse': 0x06,
    'Backspace': 0x08, 'Tab': 0x09, 'Enter': 0x0D, 'Shift': 0x10, 'Ctrl': 0x11, 'Alt': 0x12, 'Pause': 0x13, 'Caps Lock': 0x14, 'Esc': 0x1B, 'Space': 0x20,
    'Page Up': 0x21, 'Page Down': 0x22, 'End': 0x23, 'Home': 0x24, 'Left Arrow': 0x25, 'Up Arrow': 0x26, 'Right Arrow': 0x27, 'Down Arrow': 0x28, 'Select': 0x29, 'Print': 0x2A, 'Execute': 0x2B, 'Print Screen': 0x2C, 'Insert': 0x2D, 'Delete': 0x2E, 'Help': 0x2F,
    '0': 0x30, '1': 0x31, '2': 0x32, '3': 0x33, '4': 0x34, '5': 0x35, '6': 0x36, '7': 0x37, '8': 0x38, '9': 0x39,
    'A': 0x41, 'B': 0x42, 'C': 0x43, 'D': 0x44, 'E': 0x45, 'F': 0x46, 'G': 0x47, 'H': 0x48, 'I': 0x49, 'J': 0x4A, 'K': 0x4B, 'L': 0x4C, 'M': 0x4D, 'N': 0x4E, 'O': 0x4F, 'P': 0x50, 'Q': 0x51, 'R': 0x52, 'S': 0x53, 'T': 0x54, 'U': 0x55, 'V': 0x56, 'W': 0x57, 'X': 0x58, 'Y': 0x59, 'Z': 0x5A,
    'Left Win': 0x5B, 'Right Win': 0x5C, 'Apps': 0x5D,
    'Numpad 0': 0x60, 'Numpad 1': 0x61, 'Numpad 2': 0x62, 'Numpad 3': 0x63, 'Numpad 4': 0x64, 'Numpad 5': 0x65, 'Numpad 6': 0x66, 'Numpad 7': 0x67, 'Numpad 8': 0x68, 'Numpad 9': 0x69, 'Multiply': 0x6A, 'Add': 0x6B, 'Separator': 0x6C, 'Subtract': 0x6D, 'Decimal': 0x6E, 'Divide': 0x6F,
    'F1': 0x70, 'F2': 0x71, 'F3': 0x72, 'F4': 0x73, 'F5': 0x74, 'F6': 0x75, 'F7': 0x76, 'F8': 0x77, 'F9': 0x78, 'F10': 0x79, 'F11': 0x7A, 'F12': 0x7B, 'F13': 0x7C, 'F14': 0x7D, 'F15': 0x7E, 'F16': 0x7F, 'F17': 0x80, 'F18': 0x81, 'F19': 0x82, 'F20': 0x83, 'F21': 0x84, 'F22': 0x85, 'F23': 0x86, 'F24': 0x87,
    'Num Lock': 0x90, 'Scroll Lock': 0x91,
    'Left Shift': 0xA0, 'Right Shift': 0xA1, 'Left Ctrl': 0xA2, 'Right Ctrl': 0xA3, 'Left Alt': 0xA4, 'Right Alt': 0xA5,
    'Browser Back': 0xA6, 'Browser Forward': 0xA7, 'Browser Refresh': 0xA8, 'Browser Stop': 0xA9, 'Browser Search': 0xAA, 'Browser Favorites': 0xAB, 'Browser Home': 0xAC,
    'Volume Mute': 0xAD, 'Volume Down': 0xAE, 'Volume Up': 0xAF, 'Next Track': 0xB0, 'Previous Track': 0xB1, 'Stop Media': 0xB2, 'Play/Pause': 0xB3, 'Mail': 0xB4, 'Media Select': 0xB5, 'Launch App 1': 0xB6, 'Launch App 2': 0xB7,
    'Semicolon': 0xBA, 'Equals': 0xBB, 'Comma': 0xBC, 'Minus': 0xBD, 'Period': 0xBE, 'Slash': 0xBF, 'Grave': 0xC0, 'Left Bracket': 0xDB, 'Backslash': 0xDC, 'Right Bracket': 0xDD, 'Apostrophe': 0xDE,
}
def update_offsets_from_url(cpp_url, json_template_text):
    try:
        response = requests.get(cpp_url)
        response.raise_for_status()
        cpp_offsets_text = response.text
    except requests.exceptions.RequestException as e:
        print(f"Error fetching offsets from URL: {e}")
        return None
    parsed_cpp_offsets = {}
    current_namespace = None
    for line in cpp_offsets_text.splitlines():
        line = line.strip()
        namespace_match = re.match(r'namespace (\w+)', line)
        if namespace_match:
            current_namespace = namespace_match.group(1)
            continue
        offset_match = re.match(r'inline constexpr uintptr_t (\w+) = (0x[\da-fA-F]+);', line)
        if offset_match and current_namespace:
            offset_name = offset_match.group(1)
            offset_value = offset_match.group(2)
            parsed_cpp_offsets[f"{current_namespace}::{offset_name}"] = offset_value
        version_match = re.match(r'inline std::string ClientVersion = "([^"]+)";', line)
      
        if version_match:
            parsed_cpp_offsets["ClientVersion"] = version_match.group(1)
    json_data = json.loads(json_template_text)
    key_mapping = {
        "Adornee": "Misc::Adornee", "Anchored": "PrimitiveFlags::Anchored", "AnimationId": "Misc::AnimationId",
        "AttributeToNext": "Instance::AttributeToNext", "AttributeToValue": "Instance::AttributeToValue",
        "Camera": "Workspace::CurrentCamera", "CameraMaxZoomDistance": "Player::MaxZoomDistance",
        "CameraMinZoomDistance": "Player::MinZoomDistance", "CameraMode": "Player::CameraMode",
        "CameraPos": "Camera::Position", "CameraRotation": "Camera::Rotation", "CameraSubject": "Camera::CameraSubject",
        "CameraType": "Camera::CameraType", "CanCollide": "PrimitiveFlags::CanCollide", "CanTouch": "PrimitiveFlags::CanTouch",
        "Children": "Instance::ChildrenStart", "ChildrenEnd": "Instance::ChildrenEnd", "ClassDescriptor": "Instance::ClassDescriptor",
        "ClassDescriptorToClassName": "Instance::ClassName", "ClickDetectorMaxActivationDistance": "ClickDetector::MaxActivationDistance",
        "ClockTime": "Lighting::ClockTime", "CreatorId": "DataModel::CreatorId", "DataModelPrimitiveCount": "DataModel::PrimitiveCount",
        "DecalTexture": "Textures::Decal_Texture", "Dimensions": "VisualEngine::Dimensions", "DisplayName": "Player::DisplayName",
        "FOV": "Camera::FieldOfView", "FakeDataModelPointer": "FakeDataModel::Pointer", "FakeDataModelToDataModel": "FakeDataModel::RealDataModel",
        "FogColor": "Lighting::FogColor", "FogEnd": "Lighting::FogEnd", "FogStart": "Lighting::FogStart",
        "FrameRotation": "GuiObject::Rotation", "FrameSizeX": "GuiObject::Size", "GameId": "DataModel::GameId",
        "GameLoaded": "DataModel::GameLoaded", "Gravity": "Workspace::ReadOnlyGravity", "Health": "Humanoid::Health",
        "HipHeight": "Humanoid::HipHeight", "HumanoidState": "Humanoid::HumanoidState", "HumanoidStateId": "Humanoid::HumanoidStateID",
        "InputObject": "MouseService::InputObject", "InstanceAttributePointer1": "Instance::AttributeContainer",
        "InstanceAttributePointer2": "Instance::AttributeList", "JobEnd": "TaskScheduler::JobEnd", "JobId": "DataModel::JobId",
        "JobStart": "TaskScheduler::JobStart", "Job_Name": "TaskScheduler::JobName", "JumpPower": "Humanoid::JumpPower",
        "LocalPlayer": "Player::LocalPlayer", "LocalScriptByteCode": "LocalScript::ByteCode", "LocalScriptBytecodePointer": "ByteCode::Pointer",
        "LocalScriptHash": "LocalScript::Hash", "MaxHealth": "Humanoid::MaxHealth", "MaxSlopeAngle": "Humanoid::MaxSlopeAngle",
        "MeshPartTexture": "MeshPart::Texture", "ModelInstance": "Player::ModelInstance", "ModuleScriptByteCode": "ModuleScript::ByteCode",
        "ModuleScriptBytecodePointer": "ByteCode::Pointer", "ModuleScriptHash": "ModuleScript::Hash", "MoonTextureId": "Sky::MoonTextureId",
        "MousePosition": "MouseService::MousePosition", "MouseSensitivity": "MouseService::SensitivityPointer",
        "Name": "Instance::Name", "NameSize": "Misc::StringLength", "OutdoorAmbient": "Lighting::OutdoorAmbient",
        "Parent": "Instance::Parent", "PartSize": "BasePart::Size", "Ping": "StatsItem::Value", "PlaceId": "DataModel::PlaceId",
        "PlayerMouse": "Player::Mouse", "Position": "BasePart::Position", "Primitive": "BasePart::Primitive",
        "PrimitivesPointer1": "Workspace::PrimitivesPointer1", "PrimitivesPointer2": "Workspace::PrimitivesPointer2",
        "ProximityPromptActionText": "ProximityPrompt::ActionText", "ProximityPromptEnabled": "ProximityPrompt::Enabled",
        "ProximityPromptGamepadKeyCode": "ProximityPrompt::GamepadKeyCode", "ProximityPromptHoldDuraction": "ProximityPrompt::HoldDuration",
        "ProximityPromptMaxActivationDistance": "ProximityPrompt::MaxActivationDistance", "ProximityPromptMaxObjectText": "ProximityPrompt::ObjectText",
        "RenderJobToFakeDataModel": "TaskScheduler::RenderJobToFakeDataModel", "RenderJobToRenderView": "TaskScheduler::RenderJobToRenderView",
        "RigType": "Humanoid::RigType", "Rotation": "BasePart::Rotation", "ScriptContext": "DataModel::ScriptContext",
        "SkyboxBk": "Sky::SkyboxBk", "SkyboxDn": "Sky::SkyboxDn", "SkyboxFt": "Sky::SkyboxFt", "SkyboxLf": "Sky::SkyboxLf",
        "SkyboxRt": "Sky::SkyboxRt", "SkyboxUp": "Sky::SkyboxUp", "StarCount": "Sky::StarCount", "StringLength": "Misc::StringLength",
        "SunTextureId": "Sky::SunTextureId", "TaskSchedulerMaxFPS": "TaskScheduler::MaxFPS", "TaskSchedulerPointer": "TaskScheduler::Pointer",
        "Team": "Player::Team", "TeamColor": "Team::BrickColor", "TextLabelText": "GuiObject::Text", "TextLabelVisible": "GuiObject::Visible",
        "Transparency": "BasePart::Transparency", "UserId": "Player::UserId", "Value": "Misc::Value", "Velocity": "BasePart::AssemblyLinearVelocity",
        "VisualEngine": "RenderView::VisualEngine", "VisualEnginePointer": "VisualEngine::Pointer", "VisualEngineToDataModel1": "VisualEngine::ToDataModel1",
        "VisualEngineToDataModel2": "VisualEngine::ToDataModel2", "WalkSpeed": "Humanoid::Walkspeed", "WalkSpeedCheck": "Humanoid::WalkspeedCheck",
        "Workspace": "DataModel::Workspace", "viewmatrix": "VisualEngine::ViewMatrix",
    }
    if "ClientVersion" in parsed_cpp_offsets:
        json_data["RobloxVersion"] = f"Roblox Version: {parsed_cpp_offsets['ClientVersion']}"
        print(parsed_cpp_offsets['ClientVersion'])
    for json_key, cpp_key in key_mapping.items():
        if cpp_key in parsed_cpp_offsets:
            json_data[json_key] = parsed_cpp_offsets[cpp_key]
    return json.dumps(json_data, indent=2)
offsets_url = "https://imtheo.lol/Offsets/Offsets.hpp"
json_template = """
    {
      "RobloxVersion": "Roblox Version: version-4aeb17bd13994560", "ByfronVersion": "Byfron Version: Unknown", "Adornee": "0xD0",
      "Anchored": "0x26A", "AnchoredMask": "0x4", "AnimationId": "0xD0", "AttributeToNext": "0x58", "AttributeToValue": "0x18",
      "AutoJumpEnabled": "0x1DB", "BeamBrightness": "0x190", "BeamColor": "0x120", "BeamLightEmission": "0x19C", "BeamLightInfuence": "0x1A0",
      "CFrame": "0x90", "Camera": "0x410", "CameraMaxZoomDistance": "0x2F0", "CameraMinZoomDistance": "0x2F4", "CameraMode": "0x2F8",
      "CameraPos": "0x11C", "CameraRotation": "0xF8", "CameraSubject": "0xE8", "CameraType": "0x158", "CanCollide": "0x26A", "CanCollideMask": "0x8",
      "CanTouch": "0x26A", "CanTouchMask": "0x10", "CharacterAppearanceId": "0x298", "Children": "0x60", "ChildrenEnd": "0x8",
      "ClassDescriptor": "0x18", "ClassDescriptorToClassName": "0x8", "ClickDetectorMaxActivationDistance": "0x100", "ClockTime": "0x1B8",
      "CreatorId": "0x188", "DataModelDeleterPointer": "0x73A7090", "DataModelPrimitiveCount": "0x480", "DataModelToRenderView1": "0x1D0",
      "DataModelToRenderView2": "0x8", "DataModelToRenderView3": "0x28", "DecalTexture": "0x198", "Deleter": "0x10", "DeleterBack": "0x18",
      "Dimensions": "0x720", "DisplayName": "0x130", "EvaluateStateMachine": "0x1DD", "FOV": "0x160", "FakeDataModelPointer": "0x73A7088",
      "FakeDataModelToDataModel": "0x1C0", "FogColor": "0xFC", "FogEnd": "0x134", "FogStart": "0x138", "ForceNewAFKDuration": "0x1F8",
      "FramePositionOffsetX": "0x4DC", "FramePositionOffsetY": "0x4E4", "FramePositionX": "0x4D8", "FramePositionY": "0x4E0", "FrameRotation": "0x188",
      "FrameSizeOffsetX": "0x500", "FrameSizeOffsetY": "0x504", "FrameSizeX": "0x4F8", "FrameSizeY": "0x4FC", "GameId": "0x190", "GameLoaded": "0x678",
      "Gravity": "0x958", "Health": "0x194", "HealthDisplayDistance": "0x318", "HipHeight": "0x1A0", "HumanoidDisplayName": "0xD0",
      "HumanoidState": "0x858", "HumanoidStateId": "0x20", "InputObject": "0x100", "InsetMaxX": "0x100", "InsetMaxY": "0x104", "InsetMinX": "0xF8",
      "InsetMinY": "0xFC", "InstanceAttributePointer1": "0x40", "InstanceAttributePointer2": "0x18", "InstanceCapabilities": "0xD08",
      "JobEnd": "0x1D8", "JobId": "0x138", "JobStart": "0x1D0", "Job_Name": "0x18", "JobsPointer": "0x778C2C0", "JumpPower": "0x1B0",
      "LocalPlayer": "0x130", "LocalScriptByteCode": "0x1A8", "LocalScriptBytecodePointer": "0x10", "LocalScriptHash": "0x1B8", "Material": "0xD8",
      "MaxHealth": "0x1B4", "MaxSlopeAngle": "0x1B8", "MeshPartColor3": "0x194", "MeshPartTexture": "0x310", "ModelInstance": "0x360",
      "ModuleScriptByteCode": "0x150", "ModuleScriptBytecodePointer": "0x10", "ModuleScriptHash": "0x168", "MoonTextureId": "0xD8",
      "MousePosition": "0xEC", "MouseSensitivity": "0x7389F74", "MoveDirection": "0x158", "Name": "0x80", "NameDisplayDistance": "0x324",
      "NameSize": "0x10", "OnDemandInstance": "0x38", "OutdoorAmbient": "0x108", "Parent": "0x50", "PartSize": "0xFC", "Ping": "0xC8",
      "PlaceId": "0x198", "PlayerConfigurerPointer": "0x7382528", "PlayerMouse": "0xCC8", "Position": "0xB4", "Primitive": "0x150",
      "PrimitiveValidateValue": "0x3919F80", "PrimitivesPointer1": "0x428", "PrimitivesPointer2": "0xDF0", "ProximityPromptActionText": "0xD0",
      "ProximityPromptEnabled": "0x156", "ProximityPromptGamepadKeyCode": "0x13C", "ProximityPromptHoldDuraction": "0x140",
      "ProximityPromptMaxActivationDistance": "0x148", "ProximityPromptMaxObjectText": "0xF0", "RenderJobToDataModel": "0x1B0",
      "RenderJobToFakeDataModel": "0x38", "RenderJobToRenderView": "0x218", "RequireBypass": "0x870", "RigType": "0x1C8",
      "Rotation": "0x98", "RunContext": "0x148", "ScriptContext": "0x3D0", "Sit": "0x1DC", "SkyboxBk": "0x100", "SkyboxDn": "0x128",
      "SkyboxFt": "0x150", "SkyboxLf": "0x178", "SkyboxRt": "0x1A0", "SkyboxUp": "0x1C8", "SoundId": "0xE0", "StarCount": "0x220",
      "StringLength": "0x10", "SunTextureId": "0x1F0", "TagList": "0x0", "TaskSchedulerMaxFPS": "0x1B0", "TaskSchedulerPointer": "0x778C0E8",
      "Team": "0x270", "TeamColor": "0xD0", "TextLabelText": "0xA98", "TextLabelVisible": "0x571", "Tool_Grip_Position": "0x454",
      "Transparency": "0xF0", "UserId": "0x2A8", "Value": "0xD0", "Velocity": "0xC0", "ViewportSize": "0x2E8", "VisualEngine": "0x10",
      "VisualEnginePointer": "0x7109240", "VisualEngineToDataModel1": "0x700", "VisualEngineToDataModel2": "0x1C0", "WalkSpeed": "0x1D4",
      "WalkSpeedCheck": "0x3A0", "Workspace": "0x178", "WorkspaceToWorld": "0x428", "viewmatrix": "0x4B0"
    }
    """
updated_json_string = update_offsets_from_url(offsets_url, json_template)
offsets = json.loads(updated_json_string)
def initialize_controller():
    global joystick
    pygame.init()
    pygame.joystick.init()
    joystick_count = pygame.joystick.get_count()
    if joystick_count > 0:
        joystick = pygame.joystick.Joystick(0)
        joystick.init()
def is_key_pressed(key_identifier):
    global joystick
    try:
        if isinstance(key_identifier, str):
            if key_identifier.startswith("Controller Button"):
                if not joystick: return False
                pygame.event.pump()
                button_index = int(key_identifier.split(" ")[-1])
                return joystick.get_button(button_index)
            elif key_identifier == "Left Trigger":
                if not joystick: return False
                pygame.event.pump()
                return joystick.get_axis(4) > 0.5
            elif key_identifier == "Right Trigger":
                if not joystick: return False
                pygame.event.pump()
                return joystick.get_axis(5) > 0.5
            else:
                vk_code = VK_CODES.get(key_identifier)
                if vk_code:
                    return (windll.user32.GetAsyncKeyState(vk_code) & 0x8000) != 0
        else:
            return (windll.user32.GetAsyncKeyState(key_identifier) & 0x8000) != 0
    except (ValueError, IndexError, pygame.error):
        return False
    return False
def get_key_name(key_identifier):
    if isinstance(key_identifier, str):
        return key_identifier
    for name, code in VK_CODES.items():
        if code == key_identifier:
            return name
    return f"Key {key_identifier}"
def DRP(address):
    if isinstance(address, str):
        address = int(address, 16)
    return int.from_bytes(pm.read_bytes(address, 8), "little")
def simple_get_processes():
    return [{"Name": i.szExeFile.decode(), "ProcessId": i.th32ProcessID} for i in list_processes()]
def yield_for_program(program_name, printInfo=True):
    try:
        global PID, baseAddr, pm
        for proc in simple_get_processes():
            if proc["Name"] == program_name:
                pm.open_process_from_id(proc["ProcessId"])
                PID = proc["ProcessId"]
                windll.kernel32.OpenProcess(0x1038, False, PID)
                for module in pm.list_modules():
                    if module.name == "RobloxPlayerBeta.exe":
                        baseAddr = module.lpBaseOfDll
                        break
        return False
    except:
        print("Roblox not open bro :c")
def is_process_dead():
    return not pid_exists(PID)
def get_base_addr():
    return baseAddr
def ReadRobloxString(expected_address):
    string_count = pm.read_int(expected_address + 0x10)
    if string_count > 15:
        ptr = DRP(expected_address)
        return pm.read_string(ptr, string_count)
    return pm.read_string(expected_address, string_count)
def GetClassName(instance):
    ptr = pm.read_longlong(instance + 0x18)
    ptr = pm.read_longlong(ptr + 0x8)
    fl = pm.read_longlong(ptr + 0x18)
    if fl == 0x1F:
        ptr = pm.read_longlong(ptr)
    return ReadRobloxString(ptr)
def GetName(instance):
    return ReadRobloxString(DRP(instance + nameOffset))
def GetChildren(instance):
    if not instance:
        return []
    children = []
    start = DRP(instance + childrenOffset)
    if start == 0:
        return []
    end = DRP(start + 8)
    current = DRP(start)
    for _ in range(1000):
        if current == end:
            break
        children.append(pm.read_longlong(current))
        current += 0x10
    return children
def GetAllChildren3(instance):
    if not instance:
        return {}
    children_start = DRP(instance + childrenOffset)
    if not children_start:
        return {}
    children_end = DRP(children_start + 8)
    current_address = DRP(children_start)
    while current_address != children_end:
           try:
            child_instance = pm.read_longlong(current_address)
            current_address += 0x10
            if not child_instance:
                continue
            namec = GetClassName(child_instance)
            if namec == "Players":
                return child_instance
           except:
                continue
    return {}
def FindFirstChild(instance, child_name):
    if not instance:
        return 0
    start = DRP(instance + childrenOffset)
    if start == 0:
        return 0
    end = DRP(start + 8)
    current = DRP(start)
    for _ in range(1000):
        if current == end:
            break
        child = pm.read_longlong(current)
        try:
            if GetName(child) == child_name:
                return child
        except:
            pass
        current += 0x10
    return 0
def FindFirstChildOfClass(instance, class_name):
    if not instance:
        return 0
    start = DRP(instance + childrenOffset)
    if start == 0:
        return 0
    end = DRP(start + 8)
    current = DRP(start)
    for _ in range(1000):
        if current == end:
            break
        child = pm.read_longlong(current)
        try:
            if GetClassName(child) == class_name:
                return child
        except:
            pass
        current += 0x10
    return 0
def find_window_by_title(title):
    return windll.user32.FindWindowW(None, title)
def fast_normalize(vx, vy, vz):
    mag = math.sqrt(vx * vx + vy * vy + vz * vz)
    if mag == 0:
        return 0.0, 0.0, 0.0
    inv = 1.0 / mag
    return vx * inv, vy * inv, vz * inv
def cframe_look_at(fx, fy, fz, tx, ty, tz):
    lx, ly, lz = fast_normalize(tx - fx, ty - fy, tz - fz)
    if abs(ly) > 0.999:
        ux, uy, uz = 0.0, 0.0, -1.0
    else:
        ux, uy, uz = 0.0, 1.0, 0.0
    rx = uy * lz - uz * ly
    ry = uz * lx - ux * lz
    rz = ux * ly - uy * lx
    rx, ry, rz = fast_normalize(rx, ry, rz)
    ux = ly * rz - lz * ry
    uy = lz * rx - lx * rz
    uz = lx * ry - ly * rx
    return lx, ly, lz, ux, uy, uz, rx, ry, rz
def world_to_screen_with_matrix(world_pos, matrix, screen_width, screen_height):
    wx, wy, wz = world_pos
    cx = wx * matrix[0][0] + wy * matrix[0][1] + wz * matrix[0][2] + matrix[0][3]
    cy = wx * matrix[1][0] + wy * matrix[1][1] + wz * matrix[1][2] + matrix[1][3]
    cz = wx * matrix[2][0] + wy * matrix[2][1] + wz * matrix[2][2] + matrix[2][3]
    cw = wx * matrix[3][0] + wy * matrix[3][1] + wz * matrix[3][2] + matrix[3][3]
    if cw == 0:
        return None
    inv_w = 1.0 / cw
    ndc_x = cx * inv_w
    ndc_y = cy * inv_w
    ndc_z = cz * inv_w
    if ndc_z < 0 or ndc_z > 1:
        return None
    x = (ndc_x + 1.0) * 0.5 * screen_width
    y = (1.0 - ndc_y) * 0.5 * screen_height
    return int(x), int(y)
def init():
    global dataModel, wsAddr, camAddr, camCFrameRotAddr, plrsAddr, lpAddr, matrixAddr, camPosAddr, injected, oldfov
    try:
        fakeDatamodel = pm.read_longlong(baseAddr + int(offsets['FakeDataModelPointer'], 16))
        dataModel = pm.read_longlong(fakeDatamodel + int(offsets['FakeDataModelToDataModel'], 16))
        wsAddr = pm.read_longlong(dataModel + int(offsets['Workspace'], 16))
        camAddr = pm.read_longlong(wsAddr + int(offsets['Camera'], 16))
        camCFrameRotAddr = camAddr + int(offsets['CameraRotation'], 16)
        camPosAddr = camAddr + int(offsets['CameraPos'], 16)
        visualEngine = pm.read_longlong(baseAddr + int(offsets['VisualEnginePointer'], 16))
        matrixAddr = visualEngine + int(offsets['viewmatrix'], 16)
        game_tree = GetAllChildren3(dataModel)
        plrsAddr = game_tree
        lpAddr = pm.read_longlong(plrsAddr + int(offsets['LocalPlayer'], 16))
        oldfov = pm.read_float(camAddr + int(offsets["FOV"], 16))
    except:
        print('Error Getting DataModel: Outdated offsets or unsupported game')
        time.sleep(999999)
        return
    if not injected:
        injected = True
    show_main_features()
def keybind_listener():
    global waiting_for_keybind, aimbot_keybind, triggerbot_keybind, joystick,fly_keybind,speed_keybind
    while True:
        time.sleep(0.001)
        if waiting_for_keybind:
            time.sleep(0.3)
            for vk_code in range(1, 256):
                windll.user32.GetAsyncKeyState(vk_code)
            if joystick:
                pygame.event.clear()
            key_found = False
            while waiting_for_keybind and not key_found:
                for name, code in VK_CODES.items():
                    if windll.user32.GetAsyncKeyState(code) & 0x8000:
                        if code == 27:
                            waiting_for_keybind = False
                            break
                        try:
                            if "..." in dpg.get_item_label("keybind_button"):
                                aimbot_keybind = name
                                dpg.configure_item("keybind_button", label=name)
                            elif "..." in dpg.get_item_label("triggerbot_keybind_button"):
                                triggerbot_keybind = name
                                dpg.configure_item("triggerbot_keybind_button", label=name)
                            elif "..." in dpg.get_item_label("fly_keybind_button"):
                                fly_keybind = name
                                dpg.configure_item("fly_keybind_button", label=name)
                            elif "..." in dpg.get_item_label("speed_keybind_button"):
                                speed_keybind = name
                                dpg.configure_item("speed_keybind_button", label=name)
                        except Exception:
                            pass
                        waiting_for_keybind = False
                        key_found = True
                        break
                if key_found: continue
                if joystick:
                    pygame.event.pump()
                    for i in range(joystick.get_numbuttons()):
                        if joystick.get_button(i):
                            button_name = f"Controller Button {i}"
                            try:
                                if "..." in dpg.get_item_label("keybind_button"):
                                    aimbot_keybind = button_name
                                    dpg.configure_item("keybind_button", label=button_name)
                                elif "..." in dpg.get_item_label("triggerbot_keybind_button"):
                                    triggerbot_keybind = button_name
                                    dpg.configure_item("triggerbot_keybind_button", label=button_name)
                                elif "..." in dpg.get_item_label("fly_keybind_button"):
                                    fly_keybind = button_name
                                    dpg.configure_item("fly_keybind_button", label=button_name)
                                elif "..." in dpg.get_item_label("speed_keybind_button"):
                                    speed_keybind = button_name
                                    dpg.configure_item("speed_keybind_button", label=button_name)
                            except Exception:
                                pass
                            waiting_for_keybind = False
                            key_found = True
                            break
                    if key_found: continue
                    if joystick.get_axis(4) > 0.5:
                        trigger_name = "Left Trigger"
                        try:
                            if "..." in dpg.get_item_label("keybind_button"):
                                aimbot_keybind = trigger_name
                                dpg.configure_item("keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("triggerbot_keybind_button"):
                                triggerbot_keybind = trigger_name
                                dpg.configure_item("triggerbot_keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("fly_keybind_button"):
                                fly_keybind = trigger_name
                                dpg.configure_item("fly_keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("speed_keybind_button"):
                                speed_keybind = trigger_name
                                dpg.configure_item("speed_keybind_button", label=trigger_name)
                        except Exception:
                            pass
                        waiting_for_keybind = False
                        key_found = True
                    if not key_found and joystick.get_axis(5) > 0.5:
                        trigger_name = "Right Trigger"
                        try:
                            if "..." in dpg.get_item_label("keybind_button"):
                                aimbot_keybind = trigger_name
                                dpg.configure_item("keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("triggerbot_keybind_button"):
                                triggerbot_keybind = trigger_name
                                dpg.configure_item("triggerbot_keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("fly_keybind_button"):
                                fly_keybind = trigger_name
                                dpg.configure_item("fly_keybind_button", label=trigger_name)
                            elif "..." in dpg.get_item_label("speed_keybind_button"):
                                speed_keybind = trigger_name
                                dpg.configure_item("speed_keybind_button", label=trigger_name)
                        except Exception:
                            pass
                        waiting_for_keybind = False
                        key_found = True
                time.sleep(0.01)
            if not key_found:
                 try:
                    dpg.configure_item("keybind_button", label=get_key_name(aimbot_keybind))
                    dpg.configure_item("triggerbot_keybind_button", label=get_key_name(triggerbot_keybind))
                    dpg.configure_item("fly_keybind_button", label=get_key_name(fly_keybind))
                    dpg.configure_item("speed_keybind_button", label=get_key_name(speed_keybind))
                 except:
                    pass
        else:
            time.sleep(0.1)
threading.Thread(target=keybind_listener, daemon=True).start()
newtrg = 0
isvis = False
Enemy = 0
fly_enabled = False
fly_mode = "Hold"
fly_toggled = False
fly_speed = 20.0
fly_thread = None
fly_active = False
no_spread_enabled = False
rapid_fire_enabled = False
crosshair_enabled = False
crosshair_color = [0, 255, 0]
crosshair_size = 10
crosshair_thickness = 1

def no_spread_callback(sender, app_data):
    global no_spread_enabled
    no_spread_enabled = app_data

def rapid_fire_callback(sender, app_data):
    global rapid_fire_enabled
    rapid_fire_enabled = app_data

def crosshair_toggle_callback(sender, app_data):
    global crosshair_enabled
    crosshair_enabled = app_data

def crosshair_color_callback(sender, app_data):
    global crosshair_color
    crosshair_color = [int(c * 255) for c in app_data]

def crosshair_size_callback(sender, app_data):
    global crosshair_size
    crosshair_size = app_data

def crosshair_thickness_callback(sender, app_data):
    global crosshair_thickness
    crosshair_thickness = app_data

class NoSpreadThread(threading.Thread):
    def __init__(self, pm, base, offsets):
        super().__init__(daemon=True)
        self.pm = pm
        self.base = base
        self.offsets = offsets
        self.running = True
        
    def run(self):
        while self.running:
            if not no_spread_enabled and not rapid_fire_enabled:
                time.sleep(0.5)
                continue
            
            try:
                if not plrsAddr:
                    time.sleep(0.1)
                    continue

                lp = self.pm.read_longlong(plrsAddr + int(self.offsets['LocalPlayer'], 16))
                if not lp: 
                    time.sleep(0.1)
                    continue
                
                char = self.pm.read_longlong(lp + int(self.offsets['ModelInstance'], 16))
                if not char: 
                    time.sleep(0.1)
                    continue
                
                # Find Tool
                children = GetChildren(char)
                tool = None
                for child in children:
                    if GetClassName(child) == "Tool":
                        tool = child
                        break
                
                if tool:
                    self.scan_and_mod(tool)
                    
            except Exception:
                pass
            time.sleep(0.1)

    def scan_and_mod(self, instance):
        # BFS to find spread/recoil/firerate values
        queue = [instance]
        visited = set()
        count = 0
        
        while queue and count < 200:
            curr = queue.pop(0)
            if curr in visited: continue
            visited.add(curr)
            count += 1
            
            # Check name and attempt to zero matching value objects
            try:
                name = GetName(curr).lower()
                class_name = GetClassName(curr)
                val_addr = curr + int(self.offsets.get('Value', '0x0'), 16)

                # Keywords for spread/recoil and for fire-rate/delay
                spread_keywords = ("spread", "recoil", "bulletspread", "spreadangle")
                fire_keywords = ("firerate", "fire_rate", "fireRate", "reload", "delay", "cooldown")

                # No Spread Logic: try several write types for robustness
                if no_spread_enabled and any(k in name for k in spread_keywords):
                    try:
                        self.pm.write_float(val_addr, 0.0)
                    except Exception:
                        try:
                            self.pm.write_double(val_addr, 0.0)
                        except Exception:
                            try:
                                self.pm.write_int(val_addr, 0)
                            except Exception:
                                pass

                # Rapid Fire Logic
                if rapid_fire_enabled and any(k in name for k in fire_keywords):
                    try:
                        self.pm.write_float(val_addr, 0.0)
                    except Exception:
                        try:
                            self.pm.write_double(val_addr, 0.0)
                        except Exception:
                            try:
                                self.pm.write_int(val_addr, 0)
                            except Exception:
                                pass

            except Exception:
                pass

            # Add children
            try:
                children = GetChildren(curr)
                queue.extend(children)
            except:
                pass

speed_mode = "Hold"
speed_toggled = False
speed_thread = None
class FlyThread(threading.Thread):
    def __init__(self, pm, base, offsets):
        super().__init__(daemon=True)
        self.pm = pm
        self.base = base
        self.offsets = offsets
        self.running = True
        self.datamodel = 0
        self.playersS = 0
        self.zero_bytes = array([0.0, 0.0, 0.0], dtype=float32).tobytes()
    def run(self):
        while self.running:
            self.datamodel = dataModel
            global fly_enabled, fly_keybind, fly_mode, fly_toggled, fly_speed, fly_active
            time.sleep(0.0000001)
            if not fly_enabled:
                time.sleep(0.1)
                continue
            key_pressed = is_key_pressed(fly_keybind)
            if fly_mode == "Toggle":
                if key_pressed and not fly_active:
                    fly_toggled = not fly_toggled
                    fly_active = True
                elif not key_pressed:
                    fly_active = False
                should_fly = fly_toggled
            else:
                should_fly = key_pressed
            if not should_fly:
                time.sleep(0.00001)
                continue
            try:
                lp = self.pm.read_longlong(plrsAddr + int(self.offsets['LocalPlayer'], 16))
                ch = lp and self.pm.read_longlong(lp + int(self.offsets['ModelInstance'], 16))
                hr = ch and self.find_first_child(ch, "HumanoidRootPart")
                pr = hr and self.pm.read_longlong(hr + int(self.offsets['Primitive'], 16))
                ws = self.pm.read_longlong(self.datamodel + int(self.offsets['Workspace'], 16))
                ca = ws and self.pm.read_longlong(ws + int(self.offsets['Camera'], 16))
                if not all((lp, ch, hr, pr, ws, ca)):
                    time.sleep(0.00001)
                    continue
                cam_rot_addr = ca + int(self.offsets['CameraRotation'], 16)
                cam_matrix = []
                for i in range(9):
                    addr = cam_rot_addr + (i % 3) * 4 + (i // 3) * 12
                    cam_matrix.append(self.pm.read_float(addr))
                look = array([-cam_matrix[2], -cam_matrix[5], -cam_matrix[8]], dtype=float32)
                right = array([cam_matrix[0], cam_matrix[3], cam_matrix[6]], dtype=float32)
                mv = array([0.0, 0.0, 0.0], dtype=float32)
                if windll.user32.GetAsyncKeyState(87) & 0x8000:
                    mv += look
                if windll.user32.GetAsyncKeyState(83) & 0x8000:
                    mv -= look
                if windll.user32.GetAsyncKeyState(65) & 0x8000:
                    mv -= right
                if windll.user32.GetAsyncKeyState(68) & 0x8000:
                    mv += right
                if windll.user32.GetAsyncKeyState(32) & 0x8000:
                    mv[1] += 1.0
                norm = linalg.norm(mv)
                if norm > 0:
                    mv = mv / norm * fly_speed * 2
                vel_addr = pr + int(self.offsets['Velocity'], 16)
                self.pm.write_float(vel_addr, float(mv[0]))
                self.pm.write_float(vel_addr + 4, float(mv[1]))
                self.pm.write_float(vel_addr + 8, float(mv[2]))
            except Exception:
                pass
    def stop(self):
        self.running = False
    def get_children(self, inst):
        children = []
        try:
            start = self.pm.read_longlong(inst + childrenOffset)
            if start == 0:
                return []
            end = self.pm.read_longlong(start + 8)
            current = self.pm.read_longlong(start)
            for _ in range(1000):
                if current == end:
                    break
                children.append(self.pm.read_longlong(current))
                current += 0x10
        except:
            pass
        return children
    def get_class_name(self, inst):
        try:
            ptr = self.pm.read_longlong(inst + 0x18)
            ptr = self.pm.read_longlong(ptr + 0x8)
            fl = self.pm.read_longlong(ptr + 0x18)
            if fl == 0x1F:
                ptr = self.pm.read_longlong(ptr)
            return ReadRobloxString(ptr)
        except:
            return ""
    def find_first_child(self, parent, target):
        for c in self.get_children(parent):
            try:
                if GetName(c) == target:
                    return c
            except:
                pass
        return
class SpeedThread(threading.Thread):
    def __init__(self, pm, base, offsets):
        super().__init__(daemon=True)
        self.pm = pm
        self.base = base
        self.offsets = offsets
        self.running = True
        self.datamodel = 0
        self.playersS = 0
        self.zero_bytes = array([0.0, 0.0, 0.0], dtype=float32).tobytes()
    def run(self):
        while self.running:
            self.datamodel = dataModel
            global speed_enabled, speed_keybind, speed_mode, speed_toggled, speed, fly_active
            time.sleep(0.0000001)
            if not speed_enabled:
                time.sleep(0.1)
                continue
            key_pressed = is_key_pressed(speed_keybind)
            speed_fly = key_pressed
            if not speed_fly:
                time.sleep(0.00001)
                continue
            try:
                lp = self.pm.read_longlong(plrsAddr + int(self.offsets['LocalPlayer'], 16))
                ch = lp and self.pm.read_longlong(lp + int(self.offsets['ModelInstance'], 16))
                hr = ch and self.find_first_child(ch, "HumanoidRootPart")
                pr = hr and self.pm.read_longlong(hr + int(self.offsets['Primitive'], 16))
                ws = self.pm.read_longlong(self.datamodel + int(self.offsets['Workspace'], 16))
                ca = ws and self.pm.read_longlong(ws + int(self.offsets['Camera'], 16))
                if not all((lp, ch, hr, pr, ws, ca)):
                    time.sleep(0.00001)
                    continue
                cam_rot_addr = ca + int(self.offsets['CameraRotation'], 16)
                cam_matrix = []
                for i in range(9):
                    addr = cam_rot_addr + (i % 3) * 4 + (i // 3) * 12
                    cam_matrix.append(self.pm.read_float(addr))
                look = array([-cam_matrix[2], -cam_matrix[5], -cam_matrix[8]], dtype=float32)
                right = array([cam_matrix[0], cam_matrix[3], cam_matrix[6]], dtype=float32)
                mv = array([0.0, 0.0, 0.0], dtype=float32)
                if windll.user32.GetAsyncKeyState(87) & 0x8000:
                    mv += look
                if windll.user32.GetAsyncKeyState(83) & 0x8000:
                    mv -= look
                if windll.user32.GetAsyncKeyState(65) & 0x8000:
                    mv -= right
                if windll.user32.GetAsyncKeyState(68) & 0x8000:
                    mv += right
                if windll.user32.GetAsyncKeyState(32) & 0x8000:
                    mv[1] += 1.0
                norm = linalg.norm(mv)
                if norm > 0:
                    mv = mv / norm * speed * 2
                vel_addr = pr + int(self.offsets['Velocity'], 16)
                self.pm.write_float(vel_addr, float(mv[0]))
                self.pm.write_float(vel_addr + 8, float(mv[2]))
            except Exception:
                pass
    def stop(self):
        self.running = False
    def get_children(self, inst):
        children = []
        try:
            start = self.pm.read_longlong(inst + childrenOffset)
            if start == 0:
                return []
            end = self.pm.read_longlong(start + 8)
            current = self.pm.read_longlong(start)
            for _ in range(1000):
                if current == end:
                    break
                children.append(self.pm.read_longlong(current))
                current += 0x10
        except:
            pass
        return children
    def get_class_name(self, inst):
        try:
            ptr = self.pm.read_longlong(inst + 0x18)
            ptr = self.pm.read_longlong(ptr + 0x8)
            fl = self.pm.read_longlong(ptr + 0x18)
            if fl == 0x1F:
                ptr = self.pm.read_longlong(ptr)
            return ReadRobloxString(ptr)
        except:
            return ""
    def find_first_child(self, parent, target):
        for c in self.get_children(parent):
            try:
                if GetName(c) == target:
                    return c
            except:
                pass
        return 0
triggerbot_enabled = False
triggerbot_key = 0x12 # VK_MENU (Alt)
triggerbot_delay_reaction = 0.0
triggerbot_delay_shot = 100.0
global_esp_thickness = 1
streamproof_enabled = False

def toggle_streamproof(sender, app_data):
    global streamproof_enabled
    streamproof_enabled = app_data
    hwnd = windll.user32.FindWindowW(None, "Py1337")
    if hwnd:
        if streamproof_enabled:
            # WDA_EXCLUDEFROMCAPTURE = 0x00000011
            windll.user32.SetWindowDisplayAffinity(hwnd, 0x00000011)
        else:
            windll.user32.SetWindowDisplayAffinity(hwnd, 0x00000000)
    else:
        print("Streamproof: Window 'Py1337' not found!")

def triggerbot_loop():
    global triggerbot_enabled, triggerbot_key, triggerbot_delay_reaction, triggerbot_delay_shot, lockedplr, global_boxes
    while True:
        try:
            if not triggerbot_enabled or not is_key_pressed(triggerbot_key):
                time.sleep(0.01)
                continue
            
            should_shoot = False
            current_reaction = triggerbot_delay_reaction
            
            if lockedplr:
                should_shoot = True
            else:
                mx, my = swidth / 2, sheight / 2
                with thread_lock:
                    current_boxes = list(global_boxes)
                for entry in current_boxes:
                     x, y, w, h = entry["box"]
                     if x < mx < x + w and y < my < y + h:
                         should_shoot = True
                         break
            
            if should_shoot:
                time.sleep(current_reaction / 1000.0)
                win32api.mouse_event(0x0002, 0, 0, 0, 0)
                time.sleep(0.01)
                win32api.mouse_event(0x0004, 0, 0, 0, 0)
                time.sleep(triggerbot_delay_shot / 1000.0)
            else:
                time.sleep(0.001)
        except:
            time.sleep(0.01)

def aimbotLoop():
    global target, lockedplr, aimbot_fov, newtrg, aimbot_type, swidth, sheight, Enemy, isvis
    newtrg = 0
    last_scan = 0

    while True:
        try:
     
            if aimbot_type != "Camlock" or not aimbot_enabled:
                time.sleep(1)
                continue

            should_aim = is_key_pressed(aimbot_keybind)

       
            if not should_aim and time.time() - last_scan > 0.0001:
                last_scan = time.time()
                mymodel = pm.read_longlong(lpAddr + int(offsets["ModelInstance"], 16))
                mypart = FindFirstChild(mymodel, "HumanoidRootPart")
                if not mypart:
                    continue

                primitive1 = pm.read_longlong(mypart + int(offsets['Primitive'], 16))
                targetPos1 = primitive1 + int(offsets['Position'], 16)
                my_pos = np.array([
                    pm.read_float(targetPos1),
                    pm.read_float(targetPos1 + 4),
                    pm.read_float(targetPos1 + 8)
                ], dtype=np.float32)

                if matrixAddr > 0:
                    matrix_flat = [pm.read_float(matrixAddr + i * 4) for i in range(16)]
                    view_proj_matrix = np.reshape(np.array(matrix_flat, dtype=np.float32), (4, 4))
                    widthCenter, heightCenter = swidth / 2, sheight / 2
                    minDistance = float('inf')

                    for v in GetChildren(plrsAddr):
                        if v == lpAddr:
                            continue
                        char = pm.read_longlong(v + int(offsets['ModelInstance'], 16))
                        hitpart = FindFirstChild(char, aimbot_hitpart)
                        hum = FindFirstChildOfClass(char, 'Humanoid')
                        if not (hitpart and hum):
                            continue

                        health = pm.read_float(hum + int(offsets['Health'], 16))
                        if aimbot_ignoredead and health <= 0:
                            continue

                        primitive = pm.read_longlong(hitpart + int(offsets['Primitive'], 16))
                        targetPos = primitive + int(offsets['Position'], 16)
                        obj_pos = np.array([
                            pm.read_float(targetPos),
                            pm.read_float(targetPos + 4),
                            pm.read_float(targetPos + 8)
                        ], dtype=np.float32)

                        if np.linalg.norm(my_pos - obj_pos) >= 1000:
                            continue

                        screen_coords = world_to_screen_with_matrix(obj_pos, view_proj_matrix, swidth, sheight)
                        if screen_coords and screen_coords != (-1, -1):
                            distance = math.sqrt((widthCenter - screen_coords[0]) ** 2 + (heightCenter - screen_coords[1]) ** 2)
                            if distance <= aimbot_fov and distance < minDistance:
                                minDistance = distance
                                target = targetPos
                                Enemy = v
                                lockedplr = v
                                newtrg = hum

          
            if should_aim and target > 0 and matrixAddr > 0:
                
                health = pm.read_float(newtrg + int(offsets['Health'], 16))
                if health <= 0:
                    newtrg = target = lockedplr = Enemy = 0
                    continue

                cam_pos = [
                    pm.read_float(camPosAddr),
                    pm.read_float(camPosAddr + 4),
                    pm.read_float(camPosAddr + 8)
                ]
                head_pos = [
                    pm.read_float(target),
                    pm.read_float(target + 4),
                    pm.read_float(target + 8)
                ]

                lx, ly, lz, ux, uy, uz, rx, ry, rz = cframe_look_at(
                    cam_pos[0], cam_pos[1], cam_pos[2],
                    head_pos[0], head_pos[1], head_pos[2]
                )

                pm.write_float(camCFrameRotAddr + 0,  -rx)
                pm.write_float(camCFrameRotAddr + 4,   ux)
                pm.write_float(camCFrameRotAddr + 8,  -lx)
                pm.write_float(camCFrameRotAddr + 12, -ry)
                pm.write_float(camCFrameRotAddr + 16,  uy)
                pm.write_float(camCFrameRotAddr + 20, -ly)
                pm.write_float(camCFrameRotAddr + 24, -rz)
                pm.write_float(camCFrameRotAddr + 28,  uz)
                pm.write_float(camCFrameRotAddr + 32, -lz)

 
            if not should_aim and target == 0:
                target = lockedplr = newtrg = Enemy = 0

        except:
            continue


scnpos = 0
aimbot_sens = 1
def aimbotLoop2d():
    global aimbot_sens, target, lockedplr, aimbot_fov, newtrg, scnpos, aimbot_smoothness_value, aimbot_smoothness_enabled, aimbot_type, Enemy, isvis, Humanization_enabled, aimbot_enabled, matrixAddr, pm, offsets, aimbot_prediction_enabled, aimbot_prediction_x, aimbot_prediction_y, aimbot_keybind, lpAddr, aimbot_ignoreteam, aimbot_ignoredead, aimbot_hitpart, plrsAddr
    MOUSEEVENTF_MOVE = 0x0001
    MOUSEEVENTF_MOVE_NOCOALESCE = 0x2000
    class MOUSEINPUT(ctypes.Structure):
        _fields_ = [("dx", wintypes.LONG), ("dy", wintypes.LONG), ("mouseData", wintypes.DWORD), ("dwFlags", wintypes.DWORD), ("time", wintypes.DWORD), ("dwExtraInfo", ctypes.c_ulonglong)]
    class INPUT_union(ctypes.Union):
        _fields_ = [("mi", MOUSEINPUT)]
    class INPUT(ctypes.Structure):
        _fields_ = [("type", wintypes.DWORD), ("union", INPUT_union)]
    SendInput = ctypes.windll.user32.SendInput
    SendInput.argtypes = (wintypes.UINT, ctypes.POINTER(INPUT), ctypes.c_int)
    SendInput.restype = wintypes.UINT
    def send_rel_mouse_move(dx, dy, no_coalesce=True):
        if dx == 0 and dy == 0: return 
        flags = MOUSEEVENTF_MOVE | (MOUSEEVENTF_MOVE_NOCOALESCE if no_coalesce else 0)
        mi = MOUSEINPUT(int(dx), int(dy), 0, int(flags), 0, 0)
        inp = INPUT(0, INPUT_union(mi=mi))
        SendInput(1, ctypes.byref(inp), ctypes.sizeof(inp))
    easings = {'linear': lambda t: t, 'ease_in': lambda t: t * t, 'ease_out': lambda t: t * (2 - t), 'ease_in_out': lambda t: 2 * t * t if t < 0.5 else -1 + (4 - 2 * t) * t, 'curve': lambda t: t ** 3}
    easing_func = easings['linear']
    def smooth_move_by(dx, dy, smoothing=None, easing=easing_func):
        if dx == 0 and dy == 0: return
        smoothing = int(max(1, min(200, smoothing if smoothing is not None else aimbot_smoothness_value)))
        duration = max(0.0001, smoothing / 2500.0)
        steps = max(2, smoothing)
        last_x, last_y = 0.0, 0.0
        start = time.perf_counter()
        for i in range(1, steps + 1):
            t = i / steps
            e = easing(t)
            cur_x, cur_y = dx * e, dy * e
            step_x, step_y = int(round(cur_x - last_x)), int(round(cur_y - last_y))
            if step_x != 0 or step_y != 0:
                send_rel_mouse_move(step_x, step_y)
            last_x += step_x
            last_y += step_y
            sleep_for = (start + duration * t) - time.perf_counter()
            if sleep_for > 0:
                time.sleep(sleep_for)
    newtrg = scnpos = 0
    while True:
        try:
            time.sleep(0.0007)
            if aimbot_type != "Mouse" or not aimbot_enabled:
                time.sleep(1)
                continue
            should_aim = is_key_pressed(aimbot_keybind)
            if should_aim and target > 0 and matrixAddr > 0:
                hp = pm.read_float(newtrg + int(offsets['Health'], 16))
                if hp <= 0:
                    Enemy = scnpos = target = lockedplr = newtrg = 0
                    continue
                matrix_flat = [pm.read_float(matrixAddr + i * 4) for i in range(16)]
                view_proj_matrix = np.reshape(array(matrix_flat, dtype=float32), (4, 4))
                to_pos = array([pm.read_float(target), pm.read_float(target + 4), pm.read_float(target + 8)], dtype=float32)
                if aimbot_prediction_enabled:
                    try:
                        velocity_offset = target - int(offsets['Position'], 16) + int(offsets['Velocity'], 16)
                        velocity = [pm.read_float(velocity_offset + i * 4) for i in range(3)]
                        to_pos += np.array([velocity[0] * aimbot_prediction_x, velocity[1] * aimbot_prediction_y, 0])
                    except Exception:
                        pass
                screen_coords = world_to_screen_with_matrix(to_pos, view_proj_matrix, swidth, sheight)
                if screen_coords and screen_coords != (-1, -1):
                    current_mouse_x, current_mouse_y = win32api.GetCursorPos()
                    dx, dy = screen_coords[0] - current_mouse_x, screen_coords[1] - current_mouse_y
                    
                    
                    move_x = dx * aimbot_sens
                    move_y = dy * aimbot_sens

             
                

                    if aimbot_smoothness_enabled:
                        smooth_move_by(int(move_x), int(move_y))
                    else:
                        win32api.mouse_event(win32con.MOUSEEVENTF_MOVE, int(move_x), int(move_y), 0, 0)

            else:
                target = lockedplr = newtrg = scnpos = Enemy = 0
                if not find_window_by_title("Roblox") or matrixAddr <= 0:
                    time.sleep(0.1)
                    continue
                matrix_flat = [pm.read_float(matrixAddr + i * 4) for i in range(16)]
                view_proj_matrix = np.reshape(array(matrix_flat, dtype=float32), (4, 4))
                widthCenter, heightCenter = swidth / 2, sheight / 2
                minDistance = float('inf')
                for v in GetChildren(plrsAddr):
                    try:
                        if v == lpAddr:
                            continue
                        char = pm.read_longlong(v + int(offsets['ModelInstance'], 16))
                        hum = FindFirstChildOfClass(char, 'Humanoid')
                        if not hum or (aimbot_ignoredead and pm.read_float(hum + int(offsets['Health'], 16)) <= 0):
                            continue
                        targetPos = None
                        selected_part = None
                        if Humanization_enabled:
                            possible_parts = []
                            for part_name in ["HumanoidRootPart", "Head"]:
                                part_inst = FindFirstChild(char, part_name)
                                if part_inst:
                                    primitive = pm.read_longlong(part_inst + int(offsets['Primitive'], 16))
                                    possible_parts.append((primitive + int(offsets['Position'], 16), part_inst))
                            if possible_parts:
                                min_screen_dist = float('inf')
                                for pos, part_inst in possible_parts:
                                    part_pos = array([pm.read_float(pos), pm.read_float(pos + 4), pm.read_float(pos + 8)], dtype=float32)
                                    screen_coords = world_to_screen_with_matrix(part_pos, view_proj_matrix, swidth, sheight)
                                    if screen_coords and screen_coords != (-1, -1):
                                        dist = math.sqrt((widthCenter - screen_coords[0]) ** 2 + (heightCenter - screen_coords[1]) ** 2)
                                        if dist < min_screen_dist:
                                            min_screen_dist = dist
                                            targetPos, selected_part = pos, part_inst
                        else:
                            selected_part = FindFirstChild(char, aimbot_hitpart)
                            if selected_part:
                                primitive = pm.read_longlong(selected_part + int(offsets['Primitive'], 16))
                                targetPos = primitive + int(offsets['Position'], 16)
                        if not selected_part or not targetPos:
                            continue
                        mymodel = pm.read_longlong(lpAddr + int(offsets["ModelInstance"], 16))
                        mypart = FindFirstChild(mymodel, "HumanoidRootPart")
                        primitive1 = pm.read_longlong(mypart + int(offsets['Primitive'], 16))
                        targetPos1 = primitive1 + int(offsets['Position'], 16)
                        my_pos = array([pm.read_float(targetPos1 + i * 4) for i in range(3)], dtype=float32)
                        obj_pos = array([pm.read_float(targetPos + i * 4) for i in range(3)], dtype=float32)
                        if linalg.norm(my_pos - obj_pos) >= 1000:
                            continue
                        predicted_pos = obj_pos
                        if aimbot_prediction_enabled:
                            primitive = pm.read_longlong(selected_part + int(offsets['Primitive'], 16))
                            velocity_offset = primitive + int(offsets['Velocity'], 16)
                            velocity = [pm.read_float(velocity_offset + i * 4) for i in range(3)]
                            predicted_pos += np.array([velocity[0] * aimbot_prediction_x, velocity[1] * aimbot_prediction_y, 0])
                        screen_coords = world_to_screen_with_matrix(predicted_pos, view_proj_matrix, swidth, sheight)
                        if not screen_coords or screen_coords == (-1, -1):
                            continue
                        mouse_x, mouse_y = win32api.GetCursorPos()
                        screen_distance = math.sqrt((mouse_x - screen_coords[0]) ** 2 + (mouse_y - screen_coords[1]) ** 2)
                        if screen_distance <= aimbot_fov and screen_distance < minDistance:
                            minDistance = screen_distance
                            target, scnpos, lockedplr, newtrg, Enemy = targetPos, screen_coords, v, hum, v
                    except Exception:
                        continue
        except Exception:
            target = lockedplr = newtrg = scnpos = Enemy = 0
            continue
def aimbot_callback(sender, app_data):
    global aimbot_enabled
    if not injected: return
    aimbot_enabled = app_data
def fovfill_callback(sender, app_data):
    global fovfill
    fovfill = app_data
def fovglow_callback(sender, app_data):
    global fovglow
    fovglow = app_data
def esp_fov_callback(sender, app_data):
    global fovtoggle
    fovtoggle = app_data
def fly_callback(sender, app_data):
    global fly_enabled
    fly_enabled = app_data
def fovoutline_callback(sender, app_data):
    global fovoutline
    fovoutline = app_data
def aimbot_ignoreteam_callback(sender, app_data):
    global aimbot_ignoreteam
    aimbot_ignoreteam = app_data
def aimbot_humer_callback(sender, app_data):
    global Humanization_enabled
    Humanization_enabled = app_data
def aimbot_ignoredead_callback(sender, app_data):
    global aimbot_ignoredead
    aimbot_ignoredead = app_data
def aimbot_smoothness_callback(sender, app_data):
    global aimbot_smoothness_enabled
    aimbot_smoothness_enabled = app_data
def op_callback(sender, app_data):
    global opamount
    opamount = int(app_data)
def fly_speed_callback(sender, app_data):
    global fly_speed
    fly_speed = float(app_data)
def speed_enabled_callback(sender, app_data):
    global speed_enabled
    speed_enabled = app_data
def speed_value_callback(sender, app_data):
    global speed
    speed = float(app_data)
def smoothness_value_callback(sender, app_data):
    global aimbot_smoothness_value
    aimbot_smoothness_value = app_data
def sens_value_callback(sender, app_data):
    global aimbot_sens
    aimbot_sens = app_data
def fovglowamount_callback(sender, app_data):
    global fovglowamount
    fovglowamount = app_data
def keybind_callback():
    global waiting_for_keybind
    if not waiting_for_keybind:
        waiting_for_keybind = True
        dpg.configure_item("keybind_button", label="...")
def inject_callback():
    init()
def show_main_features():
    pass
def aimbot_hitpart_callback(sender, app_data):
    global aimbot_hitpart
    aimbot_hitpart = app_data
def change_shape(sender, app_data):
    global shape
    shape = app_data
def aimbot_mouse_callback(sender, app_data):
    global aimbot_type
    aimbot_type = app_data
def aimbot_prediction_checkbox(sender, app_data):
    global aimbot_prediction_enabled
    aimbot_prediction_enabled = app_data
def prediction_x_callback(sender, app_data):
    global aimbot_prediction_x
    aimbot_prediction_x = app_data
def setfov_callback(sender, app_data):
    global aimbot_fov
    aimbot_fov = app_data * 2
def prediction_y_callback(sender, app_data):
    global aimbot_prediction_y
    aimbot_prediction_y = app_data
def triggerbot_keybind_callback():
    global waiting_for_keybind
    if not waiting_for_keybind:
        waiting_for_keybind = True
        dpg.configure_item("triggerbot_keybind_button", label="...")
def fly_keybind_callback():
    global waiting_for_keybind
    if not waiting_for_keybind:
        waiting_for_keybind = True
        dpg.configure_item("fly_keybind_button", label="...")
def speed_keybind_callback():
    global waiting_for_keybind
    if not waiting_for_keybind:
        waiting_for_keybind = True
        dpg.configure_item("speed_keybind_button", label="...")
def get_configs_directory():
    home_dir = os.path.expanduser('~')
    config_dir = os.path.join(home_dir, ".py1337config")
    os.makedirs(config_dir, exist_ok=True)
    return config_dir
def get_config_files():
    config_dir = get_configs_directory()
    if not os.path.exists(config_dir):
        return []
    files = [f.replace('.json', '') for f in os.listdir(config_dir) if f.endswith('.json') and f != 'login.json']
    return files
def refresh_config_list():
    configs = get_config_files()
    dpg.configure_item("config_dropdown", items=configs)
def create_config_callback():
    new_name = dpg.get_value("new_config_name_input")
    if not new_name or not new_name.strip():
        return
    safe_name = "".join(c for c in new_name if c.isalnum() or c in (' ', '_', '-')).rstrip()
    if not safe_name:
        return
    filepath = os.path.join(get_configs_directory(), f"{safe_name}.json")
    if os.path.exists(filepath):
        return
    if save_config_to_file(filepath):
        refresh_config_list()
        dpg.set_value("config_dropdown", safe_name)
        dpg.set_value("new_config_name_input", "")
def load_selected_config():
    global keybind_bg_color, keybind_line_color, keybind_text_color, theme
    config_name = dpg.get_value("config_dropdown")
    if not config_name:
        return
    filepath = os.path.join(get_configs_directory(), f"{config_name}.json")
    load_config_from_file(filepath)
    if theme == "Pink":
        apply_purpleish_pink_theme()
        keybind_bg_color = [35, 35, 45]
        keybind_line_color = [180, 100, 255]
        keybind_text_color = [220, 220, 230]
    elif theme == "White":
        apply_white_and_grey_theme()
        keybind_bg_color = [220, 220, 220]
        keybind_line_color = [140, 140, 140]
        keybind_text_color = [20, 20, 20]
    elif theme == "Black":
        apply_black_and_white_theme()
        keybind_bg_color = [30, 30, 30]
        keybind_line_color = [80, 80, 80]
        keybind_text_color = [240, 240, 240]
    elif theme == "Blue":
        apply_blueish_cyan_theme()
        keybind_bg_color = [35, 45, 55]
        keybind_line_color = [100, 150, 200]
        keybind_text_color = [220, 230, 240]
def save_selected_config():
    config_name = dpg.get_value("config_dropdown")
    if not config_name:
        print("No config selected to save to.")
        return
    filepath = os.path.join(get_configs_directory(), f"{config_name}.json")
    save_config_to_file(filepath)
def open_config_folder():
    os.startfile(get_configs_directory())
def save_config_to_file(filepath):
    try:
        os.makedirs(os.path.dirname(filepath), exist_ok=True)
        config = {
            "aimbot": {
                "type": aimbot_type, "enabled": aimbot_enabled, "keybind": aimbot_keybind, "fov": aimbot_fov,
                "hitpart": aimbot_hitpart, "ignore_team": aimbot_ignoreteam, "ignore_dead": aimbot_ignoredead,
                "smoothness_enabled": aimbot_smoothness_enabled, "smoothness_value": aimbot_smoothness_value,
                "prediction_enabled": aimbot_prediction_enabled, "prediction_x": aimbot_prediction_x,
                "prediction_y": aimbot_prediction_y, "hum": Humanization_enabled, "flyk": fly_keybind,
                "flye": fly_enabled, "flya": fly_speed,"sens": aimbot_sens,
            },
            "esp": {
                "fovfill": fovfill, "fovglow": fovglow, "fov": fovtoggle, "fc": fovColor,
                "shape": shape, "fovout": fovoutline, "opa": opamount, "fovgl": fovglowamount,
                "show_box": global_show_box, "show_skeleton": global_show_skeleton,
                "show_name": global_show_name, "show_health": global_show_health,
                "show_distance": global_show_distance, "box_color": global_box_color,
                "dis_color": global_dis_color, "name_color": global_name_color,
                "health_color": global_health_color, "head_color": global_head_color,
                "skelly_color": global_skelly_color, "dead": global_aimbot_ignoredead,
                "team": global_IgnoreTeam, "fps": overlay_fps, "keybind": global_show_keybinds,
                "thickness": global_esp_thickness, "streamproof": streamproof_enabled
            },
            "triggerbot": {
                "enabled": triggerbot_enabled, "key": triggerbot_key, "reaction": triggerbot_delay_reaction, "shot": triggerbot_delay_shot
            },
            "menuu": {
                "key": triggerbot_keybind, "them": theme
            }
        }
        with open(filepath, 'w') as f:
            json.dump(config, f, indent=4)
        return True
    except Exception as e:
        return False
def load_config_from_file(filepath):
    global aimbot_enabled, aimbot_keybind, aimbot_fov, aimbot_hitpart, aimbot_ignoreteam, aimbot_ignoredead
    global aimbot_smoothness_enabled, aimbot_smoothness_value, aimbot_prediction_enabled, aimbot_prediction_x, aimbot_prediction_y
    global triggerbot_keybind, fovtoggle, fovfill, fovglow, fovColor, shape, Humanization_enabled
    global fovglowamount, opamount, fovoutline, theme, aimbot_type, fly_speed, fly_enabled, fly_keybind
    global global_show_box, global_show_skeleton, global_show_name, global_show_health, global_show_distance
    global global_box_color, global_dis_color, global_name_color, global_health_color, global_head_color, global_skelly_color,global_aimbot_ignoredead,global_IgnoreTeam,aimbot_sens,overlay_fps,global_show_keybinds
    global triggerbot_enabled, triggerbot_key, triggerbot_delay_reaction, triggerbot_delay_shot, global_esp_thickness, streamproof_enabled
    try:
        if not os.path.exists(filepath):
            return False
        with open(filepath, 'r') as f:
            config = json.load(f)
        if "aimbot" in config:
            aimbot_config = config["aimbot"]
            aimbot_type = aimbot_config.get("type", "Mouse")
            if aimbot_type == "Memory": aimbot_type = "Camlock"
            aimbot_sens = aimbot_config.get("sens",1.0)
            aimbot_enabled = aimbot_config.get("enabled", False)
            aimbot_keybind = aimbot_config.get("keybind", 'Right Mouse')
            fly_speed = aimbot_config.get("flya", 50)
            fly_enabled = aimbot_config.get("flye", False)
            fly_keybind = aimbot_config.get("flyk", "Q")
            aimbot_fov = aimbot_config.get("fov", 50)
            aimbot_hitpart = aimbot_config.get("hitpart", "Head")
            aimbot_ignoreteam = aimbot_config.get("ignore_team", False)
            aimbot_ignoredead = aimbot_config.get("ignore_dead", False)
            aimbot_smoothness_enabled = aimbot_config.get("smoothness_enabled", False)
            aimbot_smoothness_value = aimbot_config.get("smoothness_value", 1)
            aimbot_prediction_enabled = aimbot_config.get("prediction_enabled", False)
            aimbot_prediction_x = aimbot_config.get("prediction_x", 0)
            aimbot_prediction_y = aimbot_config.get("prediction_y", 0)
            Humanization_enabled = aimbot_config.get("hum", False)
        if "esp" in config:
            esp_config = config["esp"]
            fovtoggle = esp_config.get("fov", False)
            fovfill = esp_config.get("fovfill", False)
            fovglow = esp_config.get("fovglow", False)
            fovColor = esp_config.get("fc", [255, 255, 255, 255])
            shape = esp_config.get("shape", "circle")
            fovglowamount = esp_config.get("fovgl", 10)
            opamount = esp_config.get("opa", 255)
            fovoutline = esp_config.get("fovout", False)
            global_show_box = esp_config.get("show_box", False)
            global_show_skeleton = esp_config.get("show_skeleton", False)
            global_show_name = esp_config.get("show_name", False)
            global_show_health = esp_config.get("show_health", False)
            global_show_distance = esp_config.get("show_distance", False)
            global_box_color = esp_config.get("box_color", [255, 0, 0, 255])
            global_dis_color = esp_config.get("dis_color", [0, 255, 0, 255])
            global_name_color = esp_config.get("name_color", [0, 0, 255, 255])
            global_health_color = esp_config.get("health_color", [255, 255, 0, 255])
            global_head_color = esp_config.get("head_color", [255, 0, 255, 255])
            global_skelly_color = esp_config.get("skelly_color", [0, 255, 255, 255])
            global_aimbot_ignoredead = esp_config.get("dead",False)
            global_IgnoreTeam =  esp_config.get("team",False)
            overlay_fps = esp_config.get("fps",240)
            global_show_keybinds = esp_config.get("keybind",False)
            global_esp_thickness = esp_config.get("thickness", 1)
            streamproof_enabled = esp_config.get("streamproof", False)
        if "triggerbot" in config:
            tb_config = config["triggerbot"]
            triggerbot_enabled = tb_config.get("enabled", False)
            triggerbot_key = tb_config.get("key", 0x12)
            triggerbot_delay_reaction = tb_config.get("reaction", 0.0)
            triggerbot_delay_shot = tb_config.get("shot", 0.0)
        if "menuu" in config:
            menu_config = config["menuu"]
            triggerbot_keybind = menu_config.get("key", 'Delete')
            theme = menu_config.get("them", "Pink")
        update_gui_from_config()
        return True
    except Exception as e:
        print(f"Error loading config from {filepath}: {e}")
        return False
def update_gui_from_config():
    dpg.set_value("esp_ignoredead_checkbox",global_aimbot_ignoredead)
    dpg.set_value("esp_ignoreteam_checkbox",global_IgnoreTeam)
    dpg.set_value("aimbot_checkbox", aimbot_enabled)
    dpg.set_value("keybindlist", global_show_keybinds)
    dpg.set_value("sens_slider", aimbot_sens)
    dpg.set_value("overlay_fps_slider", overlay_fps)
    dpg.configure_item("keybind_button", label=f"{get_key_name(aimbot_keybind)}")
    dpg.set_value("aimbot_hitpart_combo", aimbot_hitpart)
    dpg.set_value("move_fly", fly_enabled)
    dpg.set_value("move_speed", fly_speed)
    dpg.set_value("aimbotfov_slider", aimbot_fov / 2)
    dpg.set_value("aimbot_ignoreteam_checkbox", aimbot_ignoreteam)
    dpg.set_value("aimbot_ignoredead_checkbox", aimbot_ignoredead)
    dpg.set_value("aimbot_smoothness_checkbox", aimbot_smoothness_enabled)
    dpg.set_value("smoothness_slider", aimbot_smoothness_value)
    dpg.set_value("aimbot_prediction_checkbox", aimbot_prediction_enabled)
    dpg.set_value("prediction_x_slider", aimbot_prediction_x)
    dpg.set_value("prediction_y_slider", aimbot_prediction_y)
    dpg.set_value("aimbot_option", aimbot_type)
    dpg.set_value("aimbot_hum_checkbox", Humanization_enabled)
    dpg.set_value("op_buffer", opamount)
    dpg.set_value("glow_buffer", fovglowamount)
    dpg.set_value("esp_outline", fovoutline)
    dpg.set_value("themer", theme)
    dpg.set_value("esp_fov", fovtoggle)
    dpg.set_value("esp_fovfill", fovfill)
    dpg.set_value("esp_fovglow", fovglow)
    dpg.set_value("fover_option", shape)
    dpg.set_value("fc", fovColor)
    dpg.configure_item("fly_keybind_button", label=f"{get_key_name(fly_keybind)}")
    dpg.configure_item("triggerbot_keybind_button", label=f"{get_key_name(triggerbot_keybind)}")
    dpg.set_value("triggerbot_checkbox", triggerbot_enabled)
    dpg.configure_item("triggerbot_shoot_key_button", label=f"Key: {get_key_name(triggerbot_key)}")
    dpg.set_value("triggerbot_reaction_slider", triggerbot_delay_reaction)
    dpg.set_value("triggerbot_shot_slider", triggerbot_delay_shot)
    dpg.set_value("esp_box_toggle", global_show_box)
    dpg.set_value("esp_skeleton_toggle", global_show_skeleton)
    dpg.set_value("esp_name_toggle", global_show_name)
    dpg.set_value("esp_health_toggle", global_show_health)
    dpg.set_value("esp_distance_toggle", global_show_distance)
    dpg.set_value("box_color_picker", global_box_color)
    dpg.set_value("dis_color_picker", global_dis_color)
    dpg.set_value("name_color_picker", global_name_color)
    dpg.set_value("health_color_picker", global_health_color)
    dpg.set_value("head_color_picker", global_head_color)
    dpg.set_value("skelly_color_picker", global_skelly_color)
    dpg.set_value("esp_thickness_slider", global_esp_thickness)
    dpg.set_value("streamproof_checkbox", streamproof_enabled)
esp_instance = None
esp_app = None
fovColor = [255, 255, 255, 255]
def update_fov_color(sender, app_data, user_data):
    if all(isinstance(c, float) and 0 <= c <= 1 for c in app_data):
        fovColor[:] = [int(c * 255) for c in app_data]
    else:
        fovColor[:] = list(app_data)
def background_process_monitor():
    global baseAddr
    try:
        while True:
            if is_process_dead():
                while not yield_for_program("RobloxPlayerBeta.exe"):
                    time.sleep(0.5)
                baseAddr = get_base_addr()
            time.sleep(0.1)
    except:
        print("Roblox isn't currently running.")
threading.Thread(target=background_process_monitor, daemon=True).start()
def apply_purpleish_pink_theme():
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (20, 20, 25, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (25, 25, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (25, 25, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_MenuBarBg, (25, 25, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Text, (220, 220, 230, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (60, 60, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (35, 35, 45, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (35, 35, 45, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (30, 30, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgCollapsed, (30, 30, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (35, 30, 45, 255))
            dpg.add_theme_color(dpg.mvThemeCol_BorderShadow, (0, 0, 0, 0))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (60, 50, 75, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (70, 60, 90, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (80, 70, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (90, 80, 110, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Button, (80, 70, 100, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (180, 100, 255, 220))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (200, 120, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Tab, (25, 25, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabHovered, (60, 50, 75, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabActive, (70, 60, 90, 255))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (120, 80, 160, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarBg, (30, 30, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrab, (80, 70, 100, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabHovered, (90, 80, 110, 220))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabActive, (100, 90, 120, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (120, 80, 160, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (150, 100, 200, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextDisabled, (80, 80, 90, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextSelectedBg, (120, 100, 140, 120))
            dpg.add_theme_color(dpg.mvThemeCol_ModalWindowDimBg, (40, 35, 50, 180))
            dpg.add_theme_style(dpg.mvStyleVar_WindowRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_ChildRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_FrameRounding, 5)
            dpg.add_theme_style(dpg.mvStyleVar_GrabRounding, 5)
            dpg.add_theme_style(dpg.mvStyleVar_TabRounding, 5)
    dpg.bind_theme(global_theme)
def apply_white_and_grey_theme():
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (240, 240, 240, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (255, 255, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (255, 255, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_MenuBarBg, (230, 230, 230, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Text, (20, 20, 20, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (200, 200, 200, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (220, 220, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (210, 210, 210, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (220, 220, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgCollapsed, (220, 220, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (200, 200, 200, 255))
            dpg.add_theme_color(dpg.mvThemeCol_BorderShadow, (0, 0, 0, 0))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (200, 200, 200, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (180, 180, 180, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (190, 190, 190, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (170, 170, 170, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Button, (180, 180, 180, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (160, 160, 160, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (140, 140, 140, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Tab, (230, 230, 230, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabHovered, (200, 200, 200, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabActive, (180, 180, 180, 255))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (80, 80, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarBg, (230, 230, 230, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrab, (180, 180, 180, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabHovered, (160, 160, 160, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabActive, (140, 140, 140, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (120, 120, 120, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (100, 100, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextDisabled, (150, 150, 150, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextSelectedBg, (180, 180, 180, 150))
            dpg.add_theme_color(dpg.mvThemeCol_ModalWindowDimBg, (20, 20, 20, 180))
            dpg.add_theme_style(dpg.mvStyleVar_TabRounding, 0)
    dpg.bind_theme(global_theme)
def apply_black_and_white_theme():
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (10, 10, 10, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (20, 20, 20, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (15, 15, 15, 255))
            dpg.add_theme_color(dpg.mvThemeCol_MenuBarBg, (25, 25, 25, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Text, (240, 240, 240, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (80, 80, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (30, 30, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (40, 40, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (20, 20, 20, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgCollapsed, (20, 20, 20, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (50, 50, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_BorderShadow, (0, 0, 0, 0))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (50, 50, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (70, 70, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (60, 60, 60, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (80, 80, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Button, (60, 60, 60, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (80, 80, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (100, 100, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Tab, (30, 30, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabHovered, (50, 50, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabActive, (70, 70, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (230, 230, 230, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarBg, (30, 30, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrab, (80, 80, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabHovered, (100, 100, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabActive, (120, 120, 120, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (150, 150, 150, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (180, 180, 180, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextDisabled, (100, 100, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextSelectedBg, (70, 70, 70, 150))
            dpg.add_theme_color(dpg.mvThemeCol_ModalWindowDimBg, (20, 20, 20, 180))
            dpg.add_theme_style(dpg.mvStyleVar_TabRounding, 0)
    dpg.bind_theme(global_theme)
def apply_blueish_cyan_theme():
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (20, 25, 30, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (25, 30, 35, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (25, 30, 35, 255))
            dpg.add_theme_color(dpg.mvThemeCol_MenuBarBg, (30, 35, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Text, (220, 230, 240, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (60, 70, 80, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (35, 45, 55, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (40, 50, 60, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (30, 40, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgCollapsed, (30, 40, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (50, 60, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_BorderShadow, (0, 0, 0, 0))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (50, 70, 90, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (60, 80, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (70, 90, 110, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (80, 100, 120, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Button, (70, 100, 130, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (100, 150, 200, 220))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (120, 170, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Tab, (30, 35, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabHovered, (50, 70, 90, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabActive, (60, 80, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (100, 180, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarBg, (30, 35, 40, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrab, (70, 100, 130, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabHovered, (80, 110, 140, 220))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabActive, (90, 120, 150, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (100, 180, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (120, 200, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextDisabled, (80, 90, 100, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextSelectedBg, (80, 120, 160, 120))
            dpg.add_theme_color(dpg.mvThemeCol_ModalWindowDimBg, (20, 25, 30, 180))
            dpg.add_theme_style(dpg.mvStyleVar_TabRounding, 0)
    dpg.bind_theme(global_theme)
def theme_callback(sender, app_data):
    global theme, keybind_bg_color, keybind_line_color, keybind_text_color
    if app_data == "Pink":
        apply_purpleish_pink_theme()
        theme = "Pink"
        keybind_bg_color = [35, 35, 45]
        keybind_line_color = [180, 100, 255]
        keybind_text_color = [220, 220, 230]
    elif app_data == "White":
        apply_white_and_grey_theme()
        theme = "White"
        keybind_bg_color = [220, 220, 220]
        keybind_line_color = [140, 140, 140]
        keybind_text_color = [20, 20, 20]
    elif app_data == "Black":
        apply_black_and_white_theme()
        theme = "Black"
        keybind_bg_color = [30, 30, 30]
        keybind_line_color = [80, 80, 80]
        keybind_text_color = [240, 240, 240]
    elif app_data == "Blue":
        apply_blueish_cyan_theme()
        theme = "Blue"
        keybind_bg_color = [35, 45, 55]
        keybind_line_color = [100, 150, 200]
        keybind_text_color = [220, 230, 240]
PLAYER_PART_CACHE = {}
childrenOffset = int(offsets['Children'], 16)
nameOffset = int(offsets['Name'], 16)
teamOffset = int(offsets['Team'], 16)
modelInstanceOffset = int(offsets['ModelInstance'], 16)
primitiveOffset = int(offsets['Primitive'], 16)
positionOffset = int(offsets['Position'], 16)
healthOffset = int(offsets['Health'], 16)
maxhealthOffset = int(offsets['MaxHealth'], 16)
global_IgnoreTeam = False
global_aimbot_ignoredead = False
def GetTargetPositions(pm):
    global PLAYER_PART_CACHE, global_wnd_height, global_wnd_width
    positions = []
    if not all([matrixAddr, lpAddr, plrsAddr]):
        return []
    width, height = global_wnd_width, global_wnd_height
    matrix_bytes = pm.read_bytes(matrixAddr, 16 * 4)
    view_proj_matrix = np.reshape(np.frombuffer(matrix_bytes, dtype=np.float32), (4, 4))
    lpTeam = pm.read_longlong(lpAddr + teamOffset)
    children = GetChildren(plrsAddr)
    if not children:
        return []
    lp_char_addr = pm.read_longlong(lpAddr + modelInstanceOffset)
    myPrim = 0
    if lp_char_addr:
        lp_head = FindFirstChild(lp_char_addr, "Head")
        if lp_head:
            myPrim = pm.read_longlong(lp_head + primitiveOffset)
    myHeadPos = np.frombuffer(pm.read_bytes(myPrim + positionOffset, 12), dtype=np.float32) if myPrim else np.array([0,0,0], dtype=np.float32)
    for v in children:
        try:
            if v == lpAddr:
                continue
            char = pm.read_longlong(v + modelInstanceOffset)
            if not char: continue
            team = pm.read_longlong(v + teamOffset)
            if global_IgnoreTeam and team == lpTeam and team > 0: continue
            hum = FindFirstChildOfClass(char, "Humanoid")
            if not hum: continue
            health = pm.read_float(hum + healthOffset)
            maxhealth = pm.read_float(hum + maxhealthOffset)
            if global_aimbot_ignoredead and health <= 0: continue
            if maxhealth <= 0: maxhealth = 100
            health = max(0.0, min(float(maxhealth), float(health)))
            cache_entry = PLAYER_PART_CACHE.get(v)
            if cache_entry and cache_entry.get('char_addr') == char:
                part_primitive_addresses = cache_entry['parts']
            else:
                is_r6 = not FindFirstChild(char, "RightFoot")
                part_map_names = {
                    "Head": "Head", "HumanoidRootPart": "HumanoidRootPart",
                    "RightArmEnd": "Right Arm" if is_r6 else "RightLowerArm",
                    "LeftArmEnd": "Left Arm" if is_r6 else "LeftLowerArm",
                    "RightLeg": "Right Leg" if is_r6 else "RightFoot",
                    "LeftLeg": "Left Leg" if is_r6 else "LeftFoot"
                }
                part_primitive_addresses = {}
                for logical_name, part_name in part_map_names.items():
                    part_obj = FindFirstChild(char, part_name)
                    prim_addr = pm.read_longlong(part_obj + primitiveOffset) if part_obj else 0
                    part_primitive_addresses[logical_name] = prim_addr
                PLAYER_PART_CACHE[v] = {'char_addr': char, 'parts': part_primitive_addresses}
            enemy_prim = part_primitive_addresses.get("Head")
            if not enemy_prim: continue
            enemy_head_pos = np.frombuffer(pm.read_bytes(enemy_prim + positionOffset, 12), dtype=np.float32)
            if not np.all(np.isfinite(enemy_head_pos)) or not np.all(np.isfinite(myHeadPos)):
                continue
            distance = int(np.linalg.norm(enemy_head_pos - myHeadPos))
            if distance >= 1000:
                continue
            if hide_distance and distance >= distancetohide: continue
            UserName = GetName(char) or "Unknown"
            skeleton_screens = {}
            left_x, top_y = float('inf'), float('inf')
            right_x, bottom_y = float('-inf'), float('-inf')
            for logical_name, prim_addr in part_primitive_addresses.items():
                if prim_addr == 0:
                    skeleton_screens[logical_name] = None
                    continue
                pos = np.frombuffer(pm.read_bytes(prim_addr + positionOffset, 12), dtype=np.float32)
                screen = world_to_screen_with_matrix(pos, view_proj_matrix, width, height)
                skeleton_screens[logical_name] = screen
                if screen and screen != (-1, -1):
                    x, y = screen
                    left_x, top_y = min(left_x, x), min(top_y, y)
                    right_x, bottom_y = max(right_x, x), max(bottom_y, y)
            box = [0, 0, 0, 0]
            if left_x != float('inf'):
                padding = 5
                box = [int(left_x - padding), int(top_y - padding),
                       int(right_x - left_x + 2 * padding), int(bottom_y - top_y + 2 * padding)]
            positions.append({
                "box": box, "name": UserName, "health": health,
                "maxhealth": maxhealth, "distance": distance, "skeleton": skeleton_screens,
                "head_ptr": enemy_prim + positionOffset
            })
        except Exception:
            continue
    return positions
def clear_cache_periodically():
    global PLAYER_PART_CACHE
    while True:
        time.sleep(2)
        PLAYER_PART_CACHE.clear()
WS_EX_LAYERED = 0x80000
WS_EX_TRANSPARENT = 0x20
WS_EX_TOPMOST = 0x00000008
WS_POPUP = 0x80000000
SW_SHOW = 5
WM_DESTROY = 0x0002
WM_CLOSE = 0x0010
AC_SRC_OVER = 0x00
AC_SRC_ALPHA = 0x01
user32 = ctypes.windll.user32
gdi32 = ctypes.windll.gdi32
kernel32 = ctypes.windll.kernel32
user32.DefWindowProcW.restype = ctypes.c_longlong
user32.DefWindowProcW.argtypes = [wintypes.HWND, wintypes.UINT, wintypes.WPARAM, wintypes.LPARAM]
user32.PostQuitMessage.argtypes = [ctypes.c_int]
class RECT(ctypes.Structure):
    _fields_ = [("left", wintypes.LONG), ("top", wintypes.LONG), ("right", wintypes.LONG), ("bottom", wintypes.LONG)]
class BITMAPINFOHEADER(ctypes.Structure):
    _fields_ = [("biSize", wintypes.DWORD), ("biWidth", wintypes.LONG), ("biHeight", wintypes.LONG), ("biPlanes", wintypes.WORD),
                ("biBitCount", wintypes.WORD), ("biCompression", wintypes.DWORD), ("biSizeImage", wintypes.DWORD),
                ("biXPelsPerMeter", wintypes.LONG), ("biYPelsPerMeter", wintypes.LONG), ("biClrUsed", wintypes.DWORD),
                ("biClrImportant", wintypes.DWORD)]
class BITMAPINFO(ctypes.Structure):
    _fields_ = [("bmiHeader", BITMAPINFOHEADER), ("bmiColors", wintypes.DWORD * 3)]
class BLENDFUNCTION(ctypes.Structure):
    _fields_ = [("BlendOp", ctypes.c_byte), ("BlendFlags", ctypes.c_byte), ("SourceConstantAlpha", ctypes.c_byte), ("AlphaFormat", ctypes.c_byte)]
class SIZE(ctypes.Structure):
    _fields_ = [("cx", ctypes.c_int), ("cy", ctypes.c_int)]
WNDPROC = ctypes.WINFUNCTYPE(ctypes.c_longlong, wintypes.HWND, wintypes.UINT, wintypes.WPARAM, wintypes.LPARAM)
class WNDCLASSW(ctypes.Structure):
    _fields_ = [("style", wintypes.UINT), ("lpfnWndProc", WNDPROC), ("cbClsExtra", ctypes.c_int), ("cbWndExtra", ctypes.c_int),
                ("hInstance", wintypes.HINSTANCE), ("hIcon", wintypes.HANDLE), ("hCursor", wintypes.HANDLE),
                ("hbrBackground", wintypes.HBRUSH), ("lpszMenuName", wintypes.LPCWSTR), ("lpszClassName", wintypes.LPCWSTR)]
user32.CreateWindowExW.restype = wintypes.HWND
user32.CreateWindowExW.argtypes = [wintypes.DWORD, wintypes.LPCWSTR, wintypes.LPCWSTR, wintypes.DWORD, ctypes.c_int, ctypes.c_int, ctypes.c_int, ctypes.c_int, wintypes.HWND, wintypes.HMENU, wintypes.HINSTANCE, wintypes.LPVOID]
user32.RegisterClassW.restype = wintypes.ATOM
user32.RegisterClassW.argtypes = [ctypes.POINTER(WNDCLASSW)]
user32.UpdateLayeredWindow.restype = wintypes.BOOL
user32.UpdateLayeredWindow.argtypes = [wintypes.HWND, wintypes.HDC, ctypes.POINTER(wintypes.POINT), ctypes.POINTER(SIZE), wintypes.HDC, ctypes.POINTER(wintypes.POINT), wintypes.COLORREF, ctypes.POINTER(BLENDFUNCTION), wintypes.DWORD]
def wnd_proc(hwnd, msg, wparam, lparam):
    if msg == WM_CLOSE or msg == WM_DESTROY:
        global_running_event.clear()
        user32.PostQuitMessage(0)
        return 0
    return user32.DefWindowProcW(hwnd, msg, wparam, lparam)
def setup_renderer():
    screen_dc = user32.GetDC(None)
    mem_dc = gdi32.CreateCompatibleDC(screen_dc)
    bmi = BITMAPINFO()
    bmi.bmiHeader.biSize = ctypes.sizeof(BITMAPINFOHEADER)
    bmi.bmiHeader.biWidth = global_wnd_width
    bmi.bmiHeader.biHeight = -global_wnd_height
    bmi.bmiHeader.biPlanes = 1
    bmi.bmiHeader.biBitCount = 32
    bmi.bmiHeader.biCompression = 0
    ppvBits = ctypes.c_void_p()
    bitmap = gdi32.CreateDIBSection(screen_dc, ctypes.byref(bmi), 0, ctypes.byref(ppvBits), None, 0)
    gdi32.SelectObject(mem_dc, bitmap)
    user32.ReleaseDC(None, screen_dc)
    return mem_dc, bitmap, ppvBits
global_hwnd = None
global_wnd_width = user32.GetSystemMetrics(0)
global_wnd_height = user32.GetSystemMetrics(1)
global_boxes = []
global_running_event = threading.Event()
global_running_event.set()
thread_lock = threading.Lock()
global_show_distance = False
global_show_box = False
global_show_name = False
global_show_health = False
global_show_skeleton = False
global_corner_box = False
global_show_head = False
global_box_color = [255, 255,255, 255]
global_dis_color = [255, 255,255, 255]
global_name_color = [255, 255, 255, 255]
global_health_color = [255, 255, 255, 255]
global_head_color = [255,255,255,255]
global_skelly_color = [255,255,255,255]
global_theme_color = [0, 255, 255, 255] # Cyan default
global_watermark_enabled = True

def rapid_fire_loop():
    global rapid_fire_key
    while True:
        if rapid_fire_key and is_key_pressed(rapid_fire_key):
            # Rapid Click Simulation
            # Release
            win32api.mouse_event(win32con.MOUSEEVENTF_LEFTUP, 0, 0, 0, 0)
            time.sleep(0.001)
            # Press
            win32api.mouse_event(win32con.MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0)
            time.sleep(0.001)
        else:
            time.sleep(0.01)

global_text_size = 16
global_dis_size = 16
global_head_size = 4
global_corner_value = 0.25
dynamic_health_color = True
hide_distance = False
distancetohide = 1000
overlay_fps = 244
def RGB(r, g, b):
    return r | (g << 8) | (b << 16)
def draw_shape(mem_dc, shape_type, x, y, r, pen, brush):
    old_pen = gdi32.SelectObject(mem_dc, pen)
    old_brush = gdi32.SelectObject(mem_dc, brush)
    if shape_type == "circle":
        gdi32.Ellipse(mem_dc, x - r, y - r, x + r, y + r)
    else:
        sides = 0
        if shape_type == "polygon": sides = 16
        elif shape_type == "triangle": sides = 3
        elif shape_type == "square": sides = 4
        elif shape_type == "star": sides = 10
        else:
             gdi32.Ellipse(mem_dc, x - r, y - r, x + r, y + r)
        if sides > 0:
            POINT_ARRAY = (wintypes.POINT * sides)()
            for i in range(sides):
                angle = i * (2 * math.pi / sides) - (math.pi / 2)
                current_radius = r if shape_type != "star" or i % 2 == 0 else r / 2
                px = int(x + current_radius * math.cos(angle))
                py = int(y + current_radius * math.sin(angle))
                POINT_ARRAY[i] = wintypes.POINT(px, py)
            gdi32.Polygon(mem_dc, POINT_ARRAY, sides)
    gdi32.SelectObject(mem_dc, old_pen)
    gdi32.SelectObject(mem_dc, old_brush)
global_show_keybinds = False
keybind_list_pos = [20, sheight // 2 - 100]
KEYBIND_LIST_WIDTH = 180
KEYBIND_LIST_HEIGHT = 110
def overlay_loop():
    global pm
    mem_dc, bitmap, ppvBits = None, None, None
    transparent_brush = gdi32.CreateSolidBrush(0x000000)
    null_brush = gdi32.GetStockObject(5)
    null_pen = gdi32.GetStockObject(8)
    dark_brush = gdi32.CreateSolidBrush(0x202020)
    name_font = gdi32.CreateFontW(global_text_size, 0,0,0,400,0,0,0,0,0,0,0,0, "Tahoma")
    dist_font = gdi32.CreateFontW(global_dis_size, 0,0,0,400,0,0,0,0,0,0,0,0, "Tahoma")
    keybind_title_font = gdi32.CreateFontW(17, 0, 0, 0, 400, 0, 0, 0, 0, 0, 0, 0, 0, "Verdana")
    keybind_entry_font = gdi32.CreateFontW(16, 0, 0, 0, 400, 0, 0, 0, 0, 0, 0, 0, 0, "Verdana")
    watermark_font = gdi32.CreateFontW(16, 0, 0, 0, 600, 0, 0, 0, 0, 0, 0, 0, 0, "Verdana") # Bold
    
    # Optimizations: Pre-create static objects
    watermark_bg_brush = gdi32.CreateSolidBrush(0x000000) # Black
    
    # Pre-create opaque black line for watermark (Manual Alpha Fix)
    # BGRA: 0x00, 0x00, 0x00, 0xFF -> Black Opaque
    watermark_opaque_row = b'\x00\x00\x00\xff' * 240
    
    # Cached Pens State
    cached_theme_color = None
    cached_accent_pen = None
    
    cached_box_color = None
    cached_box_pen = None
    
    cached_skelly_color = None
    cached_skelly_pen = None
    
    try:
        mem_dc, bitmap, ppvBits = setup_renderer()
        blend_func = BLENDFUNCTION(AC_SRC_OVER, 0, 255, AC_SRC_ALPHA)
        while global_running_event.is_set():
            try:
                frame_start_time = time.perf_counter()
                positions = GetTargetPositions(pm)
                with thread_lock:
                    global_boxes[:] = positions
                rect = RECT(0, 0, global_wnd_width, global_wnd_height)
                user32.FillRect(mem_dc, ctypes.byref(rect), transparent_brush)
                
                # Watermark
                if global_watermark_enabled:
                    wx, wy = 10, 10
                    ww, wh = 240, 30
                    
                    # Reactive Color
                    r_tm, g_tm, b_tm, _ = global_theme_color
                    current_theme_color = (r_tm, g_tm, b_tm)
                    
                    # Bar Background (Opaque Black Manual Write)
                    if ppvBits and ppvBits.value:
                         bits_addr = ppvBits.value
                         pitch = global_wnd_width * 4
                         for r_idx in range(wh):
                             dst = bits_addr + ((wy + r_idx) * pitch) + (wx * 4)
                             ctypes.memmove(dst, watermark_opaque_row, len(watermark_opaque_row))
                    else:
                         w_rect = RECT(wx, wy, wx + ww, wy + wh)
                         user32.FillRect(mem_dc, ctypes.byref(w_rect), watermark_bg_brush)
                    
                    # Accent Line (Top)
                    if cached_theme_color != current_theme_color:
                        if cached_accent_pen: gdi32.DeleteObject(cached_accent_pen)
                        cached_accent_pen = gdi32.CreatePen(0, 2, RGB(r_tm, g_tm, b_tm))
                        cached_theme_color = current_theme_color
                        
                    old_pen = gdi32.SelectObject(mem_dc, cached_accent_pen)
                    gdi32.MoveToEx(mem_dc, wx, wy, None)
                    gdi32.LineTo(mem_dc, wx + ww, wy)
                    gdi32.SelectObject(mem_dc, old_pen)
                    
                    # Text
                    gdi32.SetTextColor(mem_dc, RGB(255, 255, 255)) # White text
                    gdi32.SetBkMode(mem_dc, 1) # Transparent
                    gdi32.SelectObject(mem_dc, watermark_font)
                    w_text = "Py1337 | Made by @pyfeds"
                    ts = wintypes.SIZE()
                    gdi32.GetTextExtentPoint32W(mem_dc, w_text, len(w_text), ctypes.byref(ts))
                    gdi32.TextOutW(mem_dc, wx + (ww - ts.cx) // 2, wy + (wh - ts.cy) // 2 + 2, w_text, len(w_text))

                if global_show_keybinds:
                    kx, ky = keybind_list_pos[0], keybind_list_pos[1]
                    width, height = KEYBIND_LIST_WIDTH, KEYBIND_LIST_HEIGHT
                    padding = 10
                    r_bg, g_bg, b_bg = keybind_bg_color
                    bg_brush = gdi32.CreateSolidBrush(RGB(r_bg, g_bg, b_bg))
                    bg_rect = RECT(kx, ky, kx + width, ky + height)
                    user32.FillRect(mem_dc, ctypes.byref(bg_rect), bg_brush)
                    gdi32.DeleteObject(bg_brush)
                    r_ln, g_ln, b_ln = keybind_line_color
                    line_pen = gdi32.CreatePen(0, 1, RGB(r_ln, g_ln, b_ln))
                    old_pen = gdi32.SelectObject(mem_dc, line_pen)
                    gdi32.MoveToEx(mem_dc, kx + padding, ky + padding, None)
                    gdi32.LineTo(mem_dc, kx + width - padding, ky + padding)
                    gdi32.SelectObject(mem_dc, old_pen)
                    gdi32.DeleteObject(line_pen)
                    r_txt, g_txt, b_txt = keybind_text_color
                    gdi32.SetTextColor(mem_dc, RGB(r_txt, g_txt, b_txt))
                    gdi32.SetBkMode(mem_dc, 1)
                    gdi32.SelectObject(mem_dc, keybind_title_font)
                    title_text = "keybinds"
                    ts = wintypes.SIZE()
                    gdi32.GetTextExtentPoint32W(mem_dc, title_text, len(title_text), ctypes.byref(ts))
                    gdi32.TextOutW(mem_dc, kx + (width - ts.cx) // 2, ky + padding + 8, title_text, len(title_text))
                    gdi32.SelectObject(mem_dc, keybind_entry_font)
                    current_y = ky + padding + 35
                    keybind_entries = [("Fly", f"[{get_key_name(fly_keybind)}]"), ("Aimbot", f"[{get_key_name(aimbot_keybind)}]"), ("Menu", f"[{get_key_name(triggerbot_keybind)}]")]
                    for name, status in keybind_entries:
                        gdi32.TextOutW(mem_dc, kx + padding, current_y, name, len(name))
                        gdi32.GetTextExtentPoint32W(mem_dc, status, len(status), ctypes.byref(ts))
                        gdi32.TextOutW(mem_dc, kx + width - ts.cx - padding, current_y, status, len(status))
                        current_y += 20
                if fovtoggle:
                    current_mouse_x, current_mouse_y = win32api.GetCursorPos()
                    radius = int(aimbot_fov / 2)
                    r, g, b, a = fovColor
                    if fovglow:
                        for i in range(int(fovglowamount / 2), 0, -1):
                            glow_opacity = 0.3 * (1 - (i / (fovglowamount / 2)))
                            glow_r, glow_g, glow_b = int(r * glow_opacity), int(g * glow_opacity), int(b * glow_opacity)
                            glow_color = RGB(glow_r, glow_g, glow_b)
                            glow_brush = gdi32.CreateSolidBrush(glow_color)
                            glow_pen = gdi32.CreatePen(0, 1, glow_color)
                            draw_shape(mem_dc, shape, current_mouse_x, current_mouse_y, radius + i, glow_pen, glow_brush)
                            gdi32.DeleteObject(glow_pen)
                            gdi32.DeleteObject(glow_brush)
                    if fovfill:
                        fill_color = RGB(int(r * 0.2), int(g * 0.2), int(b*0.2))
                        fill_brush = gdi32.CreateSolidBrush(fill_color)
                        draw_shape(mem_dc, shape, current_mouse_x, current_mouse_y, radius, null_pen, fill_brush)
                        gdi32.DeleteObject(fill_brush)
                    if fovoutline:
                        outline_color = RGB(r, g, b)
                        outline_pen = gdi32.CreatePen(0, 1, outline_color)
                        draw_shape(mem_dc, shape, current_mouse_x, current_mouse_y, radius, outline_pen, null_brush)
                        gdi32.DeleteObject(outline_pen)

                # Crosshair
                if crosshair_enabled:
                    mx, my = swidth // 2, sheight // 2
                    size = crosshair_size
                    thickness = crosshair_thickness
                    r_c, g_c, b_c = crosshair_color
                    
                    crosshair_pen = gdi32.CreatePen(0, thickness, RGB(r_c, g_c, b_c))
                    old_pen = gdi32.SelectObject(mem_dc, crosshair_pen)
                    
                    # Horizontal
                    gdi32.MoveToEx(mem_dc, mx - size, my, None)
                    gdi32.LineTo(mem_dc, mx + size, my)
                    
                    # Vertical
                    gdi32.MoveToEx(mem_dc, mx, my - size, None)
                    gdi32.LineTo(mem_dc, mx, my + size)
                    
                    gdi32.SelectObject(mem_dc, old_pen)
                    gdi32.DeleteObject(crosshair_pen)

                # Update Cached Pens (Check once per frame)
                if global_show_skeleton:
                    r_sk, g_sk, b_sk, _ = global_skelly_color
                    current_skelly_color = (r_sk, g_sk, b_sk)
                    if cached_skelly_color != current_skelly_color:
                        if cached_skelly_pen: gdi32.DeleteObject(cached_skelly_pen)
                        cached_skelly_pen = gdi32.CreatePen(0, 1, RGB(r_sk, g_sk, b_sk))
                        cached_skelly_color = current_skelly_color

                if global_show_box:
                    r_box, g_box, b_box, _ = global_box_color
                    current_box_color = (r_box, g_box, b_box)
                    if cached_box_color != current_box_color:
                        if cached_box_pen: gdi32.DeleteObject(cached_box_pen)
                        cached_box_pen = gdi32.CreatePen(0, 1, RGB(r_box, g_box, b_box))
                        cached_box_color = current_box_color

                for entry in global_boxes:
                    try:
                        x, y, w, h = entry["box"]
                        if w <= 0 or h <= 0: continue
                        if global_show_skeleton and "skeleton" in entry:
                            sk = entry["skeleton"]
                            # Use cached pen
                            if cached_skelly_pen:
                                old_pen = gdi32.SelectObject(mem_dc, cached_skelly_pen)
                                def draw_line(p1_key, p2_key):
                                    p1 = sk.get(p1_key)
                                    p2 = sk.get(p2_key)
                                    if p1 and p2 and p1 != (-1, -1) and p2 != (-1, -1):
                                        gdi32.MoveToEx(mem_dc, int(p1[0]), int(p1[1]), None)
                                        gdi32.LineTo(mem_dc, int(p2[0]), int(p2[1]))
                                draw_line("Head", "HumanoidRootPart")
                                draw_line("HumanoidRootPart", "RightArmEnd")
                                draw_line("HumanoidRootPart", "LeftArmEnd")
                                draw_line("HumanoidRootPart", "RightLeg")
                                draw_line("HumanoidRootPart", "LeftLeg")
                                gdi32.SelectObject(mem_dc, old_pen)
                        if global_show_box:
                            # Use cached pen
                            if cached_box_pen:
                                old_pen = gdi32.SelectObject(mem_dc, cached_box_pen)
                                gdi32.SelectObject(mem_dc, null_brush)
                                if global_corner_box:
                                    corner_len = int(min(w, h) * global_corner_value)
                                    gdi32.MoveToEx(mem_dc, x, y + corner_len, None); gdi32.LineTo(mem_dc, x, y); gdi32.LineTo(mem_dc, x + corner_len, y)
                                    gdi32.MoveToEx(mem_dc, x + w - corner_len, y, None); gdi32.LineTo(mem_dc, x + w, y); gdi32.LineTo(mem_dc, x + w, y + corner_len)
                                    gdi32.MoveToEx(mem_dc, x + w, y + h - corner_len, None); gdi32.LineTo(mem_dc, x + w, y + h); gdi32.LineTo(mem_dc, x + w - corner_len, y + h)
                                    gdi32.MoveToEx(mem_dc, x + corner_len, y + h, None); gdi32.LineTo(mem_dc, x, y + h); gdi32.LineTo(mem_dc, x, y + h - corner_len)
                                else:
                                    gdi32.Rectangle(mem_dc, x, y, x + w, y + h)
                                gdi32.SelectObject(mem_dc, old_pen)
                        if global_show_health:
                            health, maxhealth = entry["health"], entry["maxhealth"]
                            bar_w = 1
                            fill_h = int((health / maxhealth) * h)
                            if dynamic_health_color:
                                green = int((health / maxhealth) * 255)
                                color = RGB(255 - green, green, 0)
                            else:
                                r_h, g_h, b_h, _ = global_health_color
                                color = RGB(r_h, g_h, b_h)
                            bg_rect = RECT(x - bar_w - 2, y, x - 2, y + h)
                            user32.FillRect(mem_dc, ctypes.byref(bg_rect), dark_brush)
                            if fill_h > 0:
                                fg_rect = RECT(x - bar_w - 2, y + (h - fill_h), x - 2, y + h)
                                health_brush = gdi32.CreateSolidBrush(color)
                                user32.FillRect(mem_dc, ctypes.byref(fg_rect), health_brush)
                                gdi32.DeleteObject(health_brush)
                        gdi32.SetBkMode(mem_dc, 1)
                        if global_show_name:
                            r_n, g_n, b_n, _ = global_name_color
                            gdi32.SetTextColor(mem_dc, RGB(r_n, g_n, b_n))
                            gdi32.SelectObject(mem_dc, name_font)
                            name = entry["name"]
                            ts = wintypes.SIZE()
                            gdi32.GetTextExtentPoint32W(mem_dc, name, len(name), ctypes.byref(ts))
                            gdi32.TextOutW(mem_dc, x + (w - ts.cx) // 2, y - ts.cy - 2, name, len(name))
                        if global_show_distance:
                            r_d, g_d, b_d, _ = global_dis_color
                            gdi32.SetTextColor(mem_dc, RGB(r_d, g_d, b_d))
                            gdi32.SelectObject(mem_dc, dist_font)
                            dist_text = f"[{int(entry['distance'])}m]"
                            ts = wintypes.SIZE()
                            gdi32.GetTextExtentPoint32W(mem_dc, dist_text, len(dist_text), ctypes.byref(ts))
                            gdi32.TextOutW(mem_dc, x + (w - ts.cx) // 2, y + h + 2, dist_text, len(dist_text))
                    except Exception:
                        continue
                user32.UpdateLayeredWindow(global_hwnd, None, None, ctypes.byref(SIZE(global_wnd_width, global_wnd_height)), mem_dc, ctypes.byref(wintypes.POINT(0, 0)), 0, ctypes.byref(blend_func), 2)
                elapsed_time = time.perf_counter() - frame_start_time
                sleep_duration = (1.0 / overlay_fps if overlay_fps > 0 else 0) - elapsed_time
                if sleep_duration > 0:
                    time.sleep(sleep_duration)
            except Exception:
                time.sleep(0.01)
    finally:
        if bitmap: gdi32.DeleteObject(bitmap)
        if mem_dc: gdi32.DeleteDC(mem_dc)
        if transparent_brush: gdi32.DeleteObject(transparent_brush)
        if dark_brush: gdi32.DeleteObject(dark_brush)
        if name_font: gdi32.DeleteObject(name_font)
        if dist_font: gdi32.DeleteObject(dist_font)
        if keybind_title_font: gdi32.DeleteObject(keybind_title_font)
        if keybind_entry_font: gdi32.DeleteObject(keybind_entry_font)
        if watermark_font: gdi32.DeleteObject(watermark_font)
        
        # Cleanup optimizations
        if watermark_bg_brush: gdi32.DeleteObject(watermark_bg_brush)
        if cached_accent_pen: gdi32.DeleteObject(cached_accent_pen)
        if cached_skelly_pen: gdi32.DeleteObject(cached_skelly_pen)
        if cached_box_pen: gdi32.DeleteObject(cached_box_pen)
HWND_TOPMOST = -1
SWP_NOACTIVATE = 0x0010
SWP_NOMOVE = 0x0002
SWP_NOSIZE = 0x0001
def start():
    global pm
    wc = WNDCLASSW()
    wc.lpszClassName = ctypes.c_wchar_p("OverlayWindow")
    wc.lpfnWndProc = WNDPROC(wnd_proc)
    wc.hInstance = wintypes.HINSTANCE(kernel32.GetModuleHandleW(None))
    wc.hCursor = user32.LoadCursorW(None, wintypes.LPCWSTR(32512))
    wc.hIcon = None
    wc.style = 0
    atom = user32.RegisterClassW(ctypes.byref(wc))
    if not atom:
        raise RuntimeError("RegisterClassW failed")
    global global_hwnd
    global_hwnd = user32.CreateWindowExW(WS_EX_LAYERED | WS_EX_TRANSPARENT | WS_EX_TOPMOST |  0x00000080, wc.lpszClassName, ctypes.c_wchar_p("EOverlay"), WS_POPUP, 0, 0, global_wnd_width, global_wnd_height, None, None, wc.hInstance, None)
    if not global_hwnd:
        raise RuntimeError("CreateWindowExW failed")
    user32.ShowWindow(global_hwnd, SW_SHOW)
    user32.SetWindowPos(global_hwnd, HWND_TOPMOST, 0, 0, 0, 0,
                        SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE)

    threading.Thread(target=overlay_loop, daemon=True).start()
    msg = wintypes.MSG()
    while user32.GetMessageW(ctypes.byref(msg), None, 0, 0) != 0:
        user32.TranslateMessage(ctypes.byref(msg))
        user32.DispatchMessageW(ctypes.byref(msg))
def toggle_distance(sender, app_data, user_data):
    global global_show_distance
    global_show_distance = app_data
def toggle_box(sender, app_data, user_data):
    global global_show_box
    global_show_box = app_data
def toggle_name(sender, app_data, user_data):
    global global_show_name
    global_show_name = app_data
def toggle_health(sender, app_data, user_data):
    global global_show_health
    global_show_health = app_data
def toggle_skeleton(sender, app_data, user_data):
    global global_show_skeleton
    global_show_skeleton = app_data
def color_callback(sender, app_data, user_data):
    color_variable_name = user_data
    new_color = [int(c * 255) for c in app_data]
    if color_variable_name == "global_box_color": global global_box_color; global_box_color = new_color
    elif color_variable_name == "global_dis_color": global global_dis_color; global_dis_color = new_color
    elif color_variable_name == "global_name_color": global global_name_color; global_name_color = new_color
    elif color_variable_name == "global_health_color": global global_health_color; global_health_color = new_color
    elif color_variable_name == "global_head_color": global global_head_color; global_head_color = new_color
    elif color_variable_name == "global_skelly_color": global global_skelly_color; global_skelly_color = new_color
def esp_ignoredead_callback(sender, app_data):
    global global_aimbot_ignoredead
    global_aimbot_ignoredead = app_data
def esp_ignoreteam_callback(sender, app_data):
    global global_IgnoreTeam
    global_IgnoreTeam = app_data
def esp_keybind(sender, app_data):
    global global_show_keybinds
    global_show_keybinds = app_data
def update_overlay_fps(sender, app_data):
    global overlay_fps
    overlay_fps = app_data
galaxy_window = None
class BackgroundController(QObject):
    visibility_changed = pyqtSignal(bool)
class GalaxyBackground(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        screen_geometry = QApplication.desktop().screenGeometry()
        self.setFixedSize(screen_geometry.width(), screen_geometry.height())
        self.setWindowFlags(Qt.FramelessWindowHint | Qt.WindowStaysOnTopHint | Qt.Tool)
        self.setAttribute(Qt.WA_TranslucentBackground)
        self.setAttribute(Qt.WidgetAttribute.WA_OpaquePaintEvent)
        hwnd = int(self.winId())
        extended_style = ctypes.windll.user32.GetWindowLongPtrW(hwnd, -20)
        ctypes.windll.user32.SetWindowLongPtrW(hwnd, -20, extended_style | 0x20)
        self.stars = []
        self.particles = []
        self.num_stars = 300
        self.num_particles = 20
        self.init_stars()
        self.init_particles()
        self.timer = QTimer(self)
        self.timer.timeout.connect(self.update_animation)
        self.timer.start(16)
        self.show()
        hwnd = windll.user32.FindWindowW(None, "Py1337")
        if hwnd:
                windll.user32.SetWindowPos(hwnd, -1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
        hwnd = windll.user32.FindWindowW(None, "Py1337")
        if hwnd:
                windll.user32.SetWindowPos(hwnd, -1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
    def init_stars(self):
        self.stars = []
        for _ in range(self.num_stars):
            self.stars.append({'x': random.uniform(0, self.width()), 'y': random.uniform(0, self.height()), 'size': random.uniform(1, 3), 'opacity': random.uniform(0.1, 0.8), 'speed': random.uniform(0.1, 0.5)})
    def init_particles(self):
        self.particles = []
        colors = [QColor("#6a0dad"), QColor("#2a52be"), QColor("#8e44ad")]
        for _ in range(self.num_particles):
            self.particles.append({'x': random.uniform(0, self.width()), 'y': random.uniform(0, self.height()), 'size': random.uniform(50, 200), 'color': random.choice(colors), 'opacity': random.uniform(0.01, 0.05), 'speed': random.uniform(0.2, 0.6)})
    def update_animation(self):
        for star in self.stars:
            star['x'] -= star['speed']
            if star['x'] < 0:
                star['x'] = self.width()
                star['y'] = random.uniform(0, self.height())
        for particle in self.particles:
            particle['x'] -= particle['speed']
            if particle['x'] < 0:
                particle['x'] = self.width()
                particle['y'] = random.uniform(0, self.height())
        self.update()
    def paintEvent(self, event):
        painter = QPainter(self)
        painter.setRenderHint(QPainter.Antialiasing)
        painter.setBrush(QBrush(QColor(0, 0, 0, 200)))
        painter.setPen(Qt.NoPen)
        painter.drawRect(self.rect())
        for particle in self.particles:
            color = particle['color']
            color.setAlphaF(particle['opacity'])
            painter.setBrush(QBrush(color))
            painter.drawEllipse(int(particle['x']), int(particle['y']), int(particle['size']), int(particle['size']))
        for star in self.stars:
            color = QColor(255, 255, 255)
            color.setAlphaF(star['opacity'])
            painter.setBrush(QBrush(color))
            painter.drawEllipse(int(star['x']), int(star['y']), int(star['size']), int(star['size']))
controller = None
def run_galaxy_background():
    global galaxy_window, controller
    app = QApplication.instance()
    if app is None:
        app = QApplication(sys.argv)
    controller = BackgroundController()
    galaxy_window = GalaxyBackground()
    controller.visibility_changed.connect(galaxy_window.setVisible)
    app.exec_()
known_config_files = []
def checkconfigidk():
    global known_config_files
    while True:
        current_configs = get_config_files()
        if set(current_configs) != set(known_config_files):
                known_config_files = current_configs
                if dpg.does_item_exist("config_dropdown"):
                     dpg.configure_item("config_dropdown", items=known_config_files)
        time.sleep(2)

def change_tab(sender, app_data, user_data):
    groups = ["aimbot_group", "visual_group", "world_group", "extra_group", "trigger_group", "config_group", "menu_group"]
    for g in groups:
        if dpg.does_item_exist(g):
            dpg.hide_item(g)
    if dpg.does_item_exist(user_data):
        dpg.show_item(user_data)

# World & Extras Callbacks
def toggle_world_time(sender, app_data): global world_time_enabled; world_time_enabled = app_data
def update_world_time(sender, app_data): global world_time_value; world_time_value = app_data
def toggle_world_fog(sender, app_data): global world_fog_enabled; world_fog_enabled = app_data
def update_fog_start(sender, app_data): global world_fog_start; world_fog_start = app_data
def update_fog_end(sender, app_data): global world_fog_end; world_fog_end = app_data
def update_fog_color(sender, app_data): global world_fog_color; world_fog_color = app_data[:3]
def toggle_world_ambient(sender, app_data): global world_ambient_enabled; world_ambient_enabled = app_data
def update_ambient_color(sender, app_data): global world_ambient_color; world_ambient_color = app_data[:3]
def toggle_world_gravity(sender, app_data): global world_gravity_enabled; world_gravity_enabled = app_data
def update_world_gravity(sender, app_data): global world_gravity_value; world_gravity_value = app_data
def full_bright_callback(sender, app_data): global world_ambient_enabled, world_ambient_color; world_ambient_enabled = True; world_ambient_color = (255, 255, 255)
def toggle_infinite_zoom(sender, app_data): global world_infinite_zoom; world_infinite_zoom = app_data
def full_bright_callback(sender, app_data): global world_ambient_enabled, world_ambient_color; world_ambient_enabled = True; world_ambient_color = (255, 255, 255)
def delete_doors_callback(sender, app_data): global delete_doors_flag; delete_doors_flag = True
def delete_seats_callback(sender, app_data): global delete_seats_flag; delete_seats_flag = True
def toggle_world_fov(sender, app_data): global world_fov_enabled; world_fov_enabled = app_data
def update_world_fov(sender, app_data): global world_fov_value; world_fov_value = app_data
def toggle_disco_fog(sender, app_data): global world_disco_fog; world_disco_fog = app_data
def toggle_black_sky(sender, app_data): global world_black_sky; world_black_sky = app_data
def toggle_extra_noclip(sender, app_data): global extra_noclip; extra_noclip = app_data
def toggle_extra_float(sender, app_data): global extra_float; extra_float = app_data
def toggle_extra_spam_e(sender, app_data): global extra_spam_e; extra_spam_e = app_data
def delete_trees_callback(sender, app_data): global delete_trees_flag; delete_trees_flag = True

# World & Extras loops: lighting, fog, gravity, and safe map cleanup
def world_loop():
    # World editor loop with ultra-safe memory handling to prevent crashes
    global delete_doors_flag, delete_seats_flag, delete_trees_flag, wsAddr, dataModel, pm, offsets
    
    last_ambient_write = {}
    last_fog_write = {}
    last_gravity_write = {}
    write_cooldown = 0.5  # Prevent rapid writes to same memory

    while True:
        try:
            # === SAFE AMBIENT/LIGHTING WRITE ===
            if world_ambient_enabled and dataModel:
                try:
                    lighting = FindFirstChild(dataModel, 'Lighting')
                    if lighting and pm:
                        out_amb_off = int(offsets.get('OutdoorAmbient', '0x108'), 16)
                        if out_amb_off > 0 and out_amb_off < 0x10000:
                            r, g, b = [max(0, min(255, c)) for c in world_ambient_color]
                            write_key = f"ambient_{r}_{g}_{b}"
                            if write_key not in last_ambient_write or time.time() - last_ambient_write[write_key] > write_cooldown:
                                try:
                                    pm.write_float(lighting + out_amb_off, float(r) / 255.0)
                                    pm.write_float(lighting + out_amb_off + 4, float(g) / 255.0)
                                    pm.write_float(lighting + out_amb_off + 8, float(b) / 255.0)
                                    last_ambient_write[write_key] = time.time()
                                except:
                                    pass
                except:
                    pass

            # === SAFE FOG WRITE ===
            if world_fog_enabled and dataModel:
                try:
                    lighting = FindFirstChild(dataModel, 'Lighting')
                    if lighting and pm:
                        fog_start_off = int(offsets.get('FogStart', '0x138'), 16)
                        fog_end_off = int(offsets.get('FogEnd', '0x134'), 16)
                        fog_col_off = int(offsets.get('FogColor', '0xFC'), 16)
                        
                        if all(o > 0 and o < 0x10000 for o in [fog_start_off, fog_end_off, fog_col_off]):
                            write_key = f"fog_{world_fog_start}_{world_fog_end}"
                            if write_key not in last_fog_write or time.time() - last_fog_write[write_key] > write_cooldown:
                                try:
                                    pm.write_float(lighting + fog_start_off, float(max(0, world_fog_start)))
                                    pm.write_float(lighting + fog_end_off, float(max(0, world_fog_end)))
                                    r, g, b = [max(0, min(255, c)) for c in world_fog_color]
                                    pm.write_float(lighting + fog_col_off, float(r) / 255.0)
                                    pm.write_float(lighting + fog_col_off + 4, float(g) / 255.0)
                                    pm.write_float(lighting + fog_col_off + 8, float(b) / 255.0)
                                    last_fog_write[write_key] = time.time()
                                except:
                                    pass
                except:
                    pass

            # === DISCO FOG (safe animation) ===
            if world_disco_fog and dataModel:
                try:
                    lighting = FindFirstChild(dataModel, 'Lighting')
                    if lighting and pm:
                        fog_col_off = int(offsets.get('FogColor', '0xFC'), 16)
                        if fog_col_off > 0 and fog_col_off < 0x10000:
                            t = time.time() * 0.5
                            rr = (math.sin(t) + 1.0) / 2.0
                            gg = (math.sin(t + 2.094) + 1.0) / 2.0
                            bb = (math.sin(t + 4.188) + 1.0) / 2.0
                            try:
                                pm.write_float(lighting + fog_col_off, rr)
                                pm.write_float(lighting + fog_col_off + 4, gg)
                                pm.write_float(lighting + fog_col_off + 8, bb)
                            except:
                                pass
                except:
                    pass

            # === SAFE GRAVITY WRITE ===
            if world_gravity_enabled and wsAddr:
                try:
                    gravity_off = int(offsets.get('Gravity', '0x958'), 16)
                    if gravity_off > 0 and gravity_off < 0x10000 and pm:
                        grav_val = float(max(0, min(300, world_gravity_value)))
                        write_key = f"gravity_{grav_val}"
                        if write_key not in last_gravity_write or time.time() - last_gravity_write[write_key] > write_cooldown:
                            try:
                                pm.write_float(wsAddr + gravity_off, grav_val)
                                last_gravity_write[write_key] = time.time()
                            except:
                                pass
                except:
                    pass

            # === MAP CLEANUP (safe deletion by transparency/collision) ===
            if (delete_doors_flag or delete_seats_flag or delete_trees_flag) and dataModel:
                try:
                    workspace = FindFirstChild(dataModel, 'Workspace')
                    if workspace:
                        stack = [workspace]
                        processed = 0
                        max_iter = 10000
                        
                        while stack and processed < max_iter:
                            processed += 1
                            node = stack.pop(0)
                            
                            if not node:
                                continue
                            
                            try:
                                name = GetName(node).lower()
                            except:
                                name = ''
                            
                            try:
                                cls = GetClassName(node).lower()
                            except:
                                cls = ''

                            # === SAFE PART HIDING ===
                            try:
                                if delete_doors_flag and ("door" in name or "gate" in name):
                                    t_off = int(offsets.get('Transparency', '0xF0'), 16)
                                    if t_off > 0 and t_off < 0x10000:
                                        pm.write_float(node + t_off, 1.0)
                                
                                if delete_seats_flag and ("seat" in name or cls in ("seat", "vehicleseat")):
                                    t_off = int(offsets.get('Transparency', '0xF0'), 16)
                                    if t_off > 0 and t_off < 0x10000:
                                        pm.write_float(node + t_off, 1.0)
                                
                                if delete_trees_flag and ("tree" in name or "trunk" in name or "leaf" in name):
                                    t_off = int(offsets.get('Transparency', '0xF0'), 16)
                                    if t_off > 0 and t_off < 0x10000:
                                        pm.write_float(node + t_off, 1.0)
                            except:
                                pass

                            # Push children
                            try:
                                children = GetChildren(node)
                                stack.extend(children)
                            except:
                                pass
                    
                    # Reset flags after processing
                    delete_doors_flag = False
                    delete_seats_flag = False
                    delete_trees_flag = False
                except:
                    pass

        except Exception as e:
            pass

        time.sleep(0.25)  # Slower, safer update rate

def extras_loop():
    # Extras placeholder: implement noclip/float/spam-e behaviors here if needed
    while True:
        try:
            if extra_noclip:
                # attempt to disable collisions on local player's character parts (best-effort)
                try:
                    if plrsAddr and lpAddr:
                        lp = pm.read_longlong(plrsAddr + int(offsets['LocalPlayer'], 16))
                        char = lp and pm.read_longlong(lp + int(offsets['ModelInstance'], 16))
                        if char:
                            for part in GetChildren(char):
                                try:
                                    className = GetClassName(part)
                                    if className in ["Part", "MeshPart", "BasePart", "UnionOperation"]:
                                        c_off = int(offsets.get('CanCollide', '0x0'), 16)
                                        if c_off != 0:
                                            pm.write_int(part + c_off, 0)
                                except:
                                    pass
                except:
                    pass

            if extra_float:
                # simple gentle upward velocity to simulate float
                try:
                    if plrsAddr and lpAddr:
                        lp = pm.read_longlong(plrsAddr + int(offsets['LocalPlayer'], 16))
                        char = lp and pm.read_longlong(lp + int(offsets['ModelInstance'], 16))
                        hr = char and FindFirstChild(char, "HumanoidRootPart")
                        if hr:
                            pr = pm.read_longlong(hr + int(offsets['Primitive'], 16))
                            vel = pm.read_float(pr + int(offsets['Velocity'], 16))
                            pm.write_float(pr + int(offsets['Velocity'], 16) + 4, 0.5)
                except:
                    pass

            if extra_spam_e:
                # Simulate pressing 'E' periodically
                try:
                    win32api.keybd_event(0x45, 0, 0, 0)
                    time.sleep(0.02)
                    win32api.keybd_event(0x45, 0, 2, 0)
                except:
                    pass

        except:
            pass
        time.sleep(0.12)

def triggerbot_enable_callback(sender, app_data):
    global triggerbot_enabled
    triggerbot_enabled = app_data

waiting_for_triggerbot_key = False
def triggerbot_key_callback():
    global waiting_for_triggerbot_key
    if not waiting_for_triggerbot_key:
        waiting_for_triggerbot_key = True
        dpg.configure_item("triggerbot_shoot_key_button", label="...")

def triggerbot_reaction_callback(sender, app_data):
    global triggerbot_delay_reaction
    triggerbot_delay_reaction = app_data

def triggerbot_shot_callback(sender, app_data):
    global triggerbot_delay_shot
    triggerbot_delay_shot = app_data

# Silent Aim Callbacks
def silent_aim_callback(sender, app_data):
    global silent_aim_enabled
    silent_aim_enabled = app_data

def silent_aim_fov_callback(sender, app_data):
    global silent_aim_fov
    silent_aim_fov = app_data

def silent_aim_hitchance_callback(sender, app_data):
    global silent_aim_hitchance
    silent_aim_hitchance = app_data

def silent_aim_smart_callback(sender, app_data):
    global silent_aim_smart
    silent_aim_smart = app_data

def prediction_x_silent_callback(sender, app_data):
    global silent_aim_prediction_x
    silent_aim_prediction_x = app_data

def prediction_y_silent_callback(sender, app_data):
    global silent_aim_prediction_y
    silent_aim_prediction_y = app_data

def silent_aim_key_callback():
    global waiting_for_silent_aim_key
    if not waiting_for_silent_aim_key:
        waiting_for_silent_aim_key = True
        dpg.configure_item("silent_aim_key_button", label="...")

# FOV Callbacks
def fovtoggle_callback(sender, app_data):
    global fovtoggle
    fovtoggle = app_data

def shape_callback(sender, app_data):
    global shape
    shape = app_data

def fovColor_callback(sender, app_data):
    global fovColor
    fovColor = [int(c * 255) for c in app_data]

def fovfill_callback(sender, app_data):
    global fovfill
    fovfill = app_data

def fovglow_callback(sender, app_data):
    global fovglow
    fovglow = app_data

def fovoutline_callback(sender, app_data):
    global fovoutline
    fovoutline = app_data

# FOV Changer Callbacks
def fov_changer_callback(sender, app_data):
    global fov_changer_enabled
    fov_changer_enabled = app_data

def fov_changer_value_callback(sender, app_data):
    global fov_changer_value
    fov_changer_value = app_data

# Chams Callbacks
def chams_callback(sender, app_data):
    global chams_enabled
    chams_enabled = app_data

def chams_type_callback(sender, app_data):
    global chams_type
    chams_type = app_data

def chams_color_callback(sender, app_data):
    global chams_color
    chams_color = app_data

def esp_thickness_callback(sender, app_data):
    global global_esp_thickness
    global_esp_thickness = app_data

def triggerbot_key_listener():
    global waiting_for_triggerbot_key, triggerbot_key
    while True:
        if waiting_for_triggerbot_key:
            for i in range(3, 255):
                if win32api.GetAsyncKeyState(i) & 0x8000:
                    triggerbot_key = i
                    waiting_for_triggerbot_key = False
                    dpg.configure_item("triggerbot_shoot_key_button", label=f"Key: {get_key_name(triggerbot_key)}")
                    time.sleep(0.2)
                    break
        time.sleep(0.05)

def silent_aim_key_listener():
    global waiting_for_silent_aim_key, silent_aim_key
    while True:
        if waiting_for_silent_aim_key:
            for i in range(3, 255):
                if win32api.GetAsyncKeyState(i) & 0x8000:
                    silent_aim_key = i
                    waiting_for_silent_aim_key = False
                    dpg.configure_item("silent_aim_key_button", label=f"Key: {get_key_name(silent_aim_key)}")
                    time.sleep(0.2)
                    break
        time.sleep(0.05)

def silent_aim_toggle_listener():
    """Toggle silent aim on key press (edge-detect)."""
    global silent_aim_key, silent_aim_enabled
    prev = False
    while True:
        try:
            pressed = (win32api.GetAsyncKeyState(silent_aim_key) & 0x8000) != 0
            if pressed and not prev:
                silent_aim_enabled = not silent_aim_enabled
                prev = True
            elif not pressed:
                prev = False
        except Exception:
            prev = False
        time.sleep(0.06)

def rapid_fire_key_callback(sender, app_data):
    global waiting_for_rapid_fire_key
    waiting_for_rapid_fire_key = True
    dpg.configure_item("rapid_fire_key_button", label="Press any key...")

def rapid_fire_key_listener():
    global waiting_for_rapid_fire_key, rapid_fire_key
    while True:
        if waiting_for_rapid_fire_key:
            for i in range(3, 255):
                if win32api.GetAsyncKeyState(i) & 0x8000:
                    rapid_fire_key = i
                    waiting_for_rapid_fire_key = False
                    dpg.configure_item("rapid_fire_key_button", label=f"Key: {get_key_name(rapid_fire_key)}")
                    time.sleep(0.2)
                    break
        time.sleep(0.05)

def silent_aim_loop():
    global silent_aim_enabled, silent_aim_key, silent_aim_fov, silent_aim_hitchance, silent_aim_smart
    global silent_aim_prediction_x, silent_aim_prediction_y, offsets, pm, camCFrameRotAddr, plrsAddr, lpAddr, matrixAddr
    
    while True:
        try:
            if not silent_aim_enabled:
                time.sleep(0.1)
                continue
                
            # Silent aim is controlled by toggle; do not require holding the key
            
            if not pm or not plrsAddr or not lpAddr or not matrixAddr:
                time.sleep(0.1)
                continue

            # Target Finding (store both screen and world positions)
            target_screen = None
            target_world = None
            min_dist = silent_aim_fov
            mx, my = swidth / 2, sheight / 2

            # Read ViewMatrix
            matrix_flat = [pm.read_float(matrixAddr + i * 4) for i in range(16)]
            view_proj_matrix = np.reshape(array(matrix_flat, dtype=float32), (4, 4))

            # Get My Team
            my_team = 0
            if aimbot_ignoreteam:
                try:
                    my_team = pm.read_longlong(lpAddr + int(offsets['Team'], 16))
                except: pass

            players = GetChildren(plrsAddr)
            for p in players:
                if p == lpAddr: continue
                
                # Team Check
                if aimbot_ignoreteam and my_team != 0:
                    try:
                        their_team = pm.read_longlong(p + int(offsets['Team'], 16))
                        if my_team == their_team: continue
                    except: pass
                
                try:
                    char = pm.read_longlong(p + int(offsets['ModelInstance'], 16))
                    if not char: continue
                    
                    hum = FindFirstChildOfClass(char, 'Humanoid')
                    if not hum: continue
                    
                    # Health Check
                    hp = pm.read_float(hum + int(offsets['Health'], 16))
                    if hp <= 0: continue
                    
                    # Get Head
                    head = FindFirstChild(char, "Head")
                    if not head: continue
                    
                    primitive = pm.read_longlong(head + int(offsets['Primitive'], 16))
                    pos_addr = primitive + int(offsets['Position'], 16)
                    
                    vec = [pm.read_float(pos_addr + i * 4) for i in range(3)]
                    world_pos = array(vec, dtype=float32)

                    # Prediction (apply to world position)
                    if silent_aim_smart:
                        vel_offset = primitive + int(offsets['Velocity'], 16)
                        vel = [pm.read_float(vel_offset + i * 4) for i in range(3)]
                        world_pos = world_pos + np.array([vel[0] * silent_aim_prediction_x, vel[1] * silent_aim_prediction_y, 0])

                    screen = world_to_screen_with_matrix(world_pos, view_proj_matrix, swidth, sheight)
                    if not screen or screen == (-1, -1): continue
                    
                    dist = math.sqrt((mx - screen[0])**2 + (my - screen[1])**2)
                    if dist < min_dist:
                        min_dist = dist
                        target_screen = screen
                        target_world = world_pos
                except: continue
            
            if target_screen and target_world is not None:
                # Hitchance check (0-100 percent)
                if random.randint(1, 100) <= max(0, min(100, int(silent_aim_hitchance))):
                    try:
                        cam_pos = [
                            pm.read_float(camPosAddr),
                            pm.read_float(camPosAddr + 4),
                            pm.read_float(camPosAddr + 8)
                        ]

                        # Compute rotation to the world-space target
                        lx, ly, lz, ux, uy, uz, rx, ry, rz = cframe_look_at(
                            cam_pos[0], cam_pos[1], cam_pos[2],
                            float(target_world[0]), float(target_world[1]), float(target_world[2])
                        )

                        # Write Rotation Matrix (Memory Silent Aim)
                        pm.write_float(camCFrameRotAddr + 0, rx)
                        pm.write_float(camCFrameRotAddr + 4, ux)
                        pm.write_float(camCFrameRotAddr + 8, -lx)

                        pm.write_float(camCFrameRotAddr + 12, ry)
                        pm.write_float(camCFrameRotAddr + 16, uy)
                        pm.write_float(camCFrameRotAddr + 20, -ly)

                        pm.write_float(camCFrameRotAddr + 24, rz)
                        pm.write_float(camCFrameRotAddr + 28, uz)
                        pm.write_float(camCFrameRotAddr + 32, -lz)

                        # Fire the weapon (simulate click) shortly after rotation write
                        win32api.mouse_event(win32con.MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0)
                        time.sleep(0.01)
                        win32api.mouse_event(win32con.MOUSEEVENTF_LEFTUP, 0, 0, 0, 0)

                    except Exception:
                        pass

                    time.sleep(0.05)
                else:
                    # Simulate miss/delay when hitchance fails
                    time.sleep(0.05)
            else:
                time.sleep(0.005)
                
        except Exception as e:
            time.sleep(0.01)

def chams_loop():
    global chams_enabled, chams_color, chams_type, plrsAddr, offsets, pm, lpAddr, aimbot_ignoreteam
    
    # Material Enum
    MAT_PLASTIC = 256
    MAT_NEON = 288
    MAT_FORCEFIELD = 280
    
    last_enabled = False
    
    while True:
        try:
            # Safely get offsets
            OFFSET_MATERIAL = int(offsets.get('Material', 0xD8)) if isinstance(offsets.get('Material', 0xD8), int) else int(offsets.get('Material', '0xD8'), 16)
            OFFSET_COLOR = int(offsets.get('MeshPartColor3', 0x194)) if isinstance(offsets.get('MeshPartColor3', 0x194), int) else int(offsets.get('MeshPartColor3', '0x194'), 16)
            
            if not chams_enabled:
                if last_enabled:
                    # Reset Chams (Turn off)
                    last_enabled = False
                    if plrsAddr and lpAddr:
                        try:
                            players = GetChildren(plrsAddr)
                            for player in players:
                                if player == lpAddr: continue
                                try:
                                    character = pm.read_longlong(player + int(offsets['ModelInstance'], 16))
                                    if not character: continue
                                    parts = GetChildren(character)
                                    for part in parts:
                                        try:
                                            className = GetClassName(part)
                                            if className in ["Part", "MeshPart", "BasePart", "UnionOperation"]:
                                                pm.write_int(part + OFFSET_MATERIAL, MAT_PLASTIC)
                                                pm.write_float(part + OFFSET_COLOR, 1.0)
                                                pm.write_float(part + OFFSET_COLOR + 4, 1.0)
                                                pm.write_float(part + OFFSET_COLOR + 8, 1.0)
                                            elif className == "Accessory":
                                                handle = FindFirstChild(part, "Handle")
                                                if handle:
                                                    pm.write_int(handle + OFFSET_MATERIAL, MAT_PLASTIC)
                                                    pm.write_float(handle + OFFSET_COLOR, 1.0)
                                                    pm.write_float(handle + OFFSET_COLOR + 4, 1.0)
                                                    pm.write_float(handle + OFFSET_COLOR + 8, 1.0)
                                        except: pass
                                except: pass
                        except: pass
                time.sleep(1)
                continue
                
            last_enabled = True
            
            if not plrsAddr or not lpAddr:
                time.sleep(1)
                continue
            
            # Determine Material
            target_material = MAT_PLASTIC
            if chams_type == "Glow": target_material = MAT_NEON
            elif chams_type == "Matte": target_material = MAT_PLASTIC
            elif chams_type == "Solid": target_material = MAT_FORCEFIELD
            
            # Color
            r, g, b = int(chams_color[0]), int(chams_color[1]), int(chams_color[2])
            
            # Team Check
            my_team = 0
            if aimbot_ignoreteam:
                try:
                    my_team = pm.read_longlong(lpAddr + int(offsets['Team'], 16))
                except: pass
            
            players = GetChildren(plrsAddr)
            for player in players:
                if player == lpAddr: continue
                
                # Team Check
                if aimbot_ignoreteam and my_team != 0:
                    try:
                        their_team = pm.read_longlong(player + int(offsets['Team'], 16))
                        if my_team == their_team: continue
                    except: pass
                
                try:
                    character = pm.read_longlong(player + int(offsets['ModelInstance'], 16))
                    if not character: continue
                    
                    parts = GetChildren(character)
                    for part in parts:
                        try:
                            # Class Check
                            className = GetClassName(part)
                            if className in ["Part", "MeshPart", "BasePart", "UnionOperation"]:
                                pm.write_int(part + OFFSET_MATERIAL, target_material)
                                pm.write_float(part + OFFSET_COLOR, r / 255.0)
                                pm.write_float(part + OFFSET_COLOR + 4, g / 255.0)
                                pm.write_float(part + OFFSET_COLOR + 8, b / 255.0)
                            elif className == "Accessory":
                                handle = FindFirstChild(part, "Handle")
                                if handle:
                                    pm.write_int(handle + OFFSET_MATERIAL, target_material)
                                    pm.write_float(handle + OFFSET_COLOR, r / 255.0)
                                    pm.write_float(handle + OFFSET_COLOR + 4, g / 255.0)
                                    pm.write_float(handle + OFFSET_COLOR + 8, b / 255.0)
                        except: pass
                except: pass
                        
            time.sleep(0.1)
        except:
            time.sleep(1)




def apply_premium_theme():
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            # Rounding
            dpg.add_theme_style(dpg.mvStyleVar_WindowRounding, 10)
            dpg.add_theme_style(dpg.mvStyleVar_ChildRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_FrameRounding, 6)
            dpg.add_theme_style(dpg.mvStyleVar_PopupRounding, 6)
            dpg.add_theme_style(dpg.mvStyleVar_ScrollbarRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_GrabRounding, 6)
            
            # Spacing
            dpg.add_theme_style(dpg.mvStyleVar_ItemSpacing, 8, 8)
            dpg.add_theme_style(dpg.mvStyleVar_WindowPadding, 10, 10)
            
            # Colors (Dark & Cyan Theme)
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (25, 25, 25, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (35, 35, 35, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (35, 35, 35, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (60, 60, 60, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (45, 45, 45, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (60, 60, 60, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (0, 200, 200, 150))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (25, 25, 25, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (25, 25, 25, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Button, (50, 50, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (70, 70, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (0, 255, 255, 200))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (0, 255, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (0, 255, 255, 200))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (0, 255, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Text, (220, 220, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (50, 50, 50, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (70, 70, 70, 255))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (0, 255, 255, 100))
            
    dpg.bind_theme(global_theme)

def login_callback(sender, app_data, user_data):
    key = dpg.get_value("license_input")
    dpg.set_value("login_status", "Checking...")
    
    # Simulate slight delay for effect or real check
    # In a real GUI loop, we shouldn't block, but for this quick check it's fine.
    try:
        if not keyauthapp:
             dpg.set_value("login_status", "KeyAuth Error: Missing Secret or Init Failed")
             return

        if keyauthapp.license(key):
            dpg.delete_item("Login Window")
            dpg.set_viewport_width(820)
            dpg.set_viewport_height(620)
            setup_premium_gui()
            
            # Load configs after GUI is setup
            refresh_config_list()
            config_list = get_config_files()
            if config_list:
                try:
                    first_config = config_list[0]
                    dpg.set_value("config_dropdown", first_config)
                    load_selected_config()
                except: pass
            else:
                try:
                    dpg.set_value("new_config_name_input", "default")
                    create_config_callback()
                except: pass
        else:
            dpg.set_value("login_status", "Invalid License Key!")
            
    except Exception as e:
        dpg.set_value("login_status", f"Error: {e}")

def apply_premium_ultimate_theme():
    """Ultra-premium dark neon theme with cyan/magenta accents"""
    with dpg.theme() as global_theme:
        with dpg.theme_component(dpg.mvAll):
            # === DARK PREMIUM PALETTE ===
            dpg.add_theme_color(dpg.mvThemeCol_WindowBg, (10, 10, 15, 255))
            dpg.add_theme_color(dpg.mvThemeCol_ChildBg, (12, 12, 18, 255))
            dpg.add_theme_color(dpg.mvThemeCol_PopupBg, (15, 15, 22, 255))
            dpg.add_theme_color(dpg.mvThemeCol_MenuBarBg, (12, 12, 18, 255))
            dpg.add_theme_color(dpg.mvThemeCol_Border, (40, 40, 60, 255))
            
            # === FRAME COLORS ===
            dpg.add_theme_color(dpg.mvThemeCol_FrameBg, (20, 20, 35, 255))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgHovered, (30, 30, 55, 200))
            dpg.add_theme_color(dpg.mvThemeCol_FrameBgActive, (0, 255, 255, 180))
            
            # === TEXT & ACCENTS ===
            dpg.add_theme_color(dpg.mvThemeCol_Text, (230, 230, 245, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextDisabled, (100, 100, 120, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TextSelectedBg, (0, 200, 200, 100))
            
            # === BUTTONS - CYAN/NEON ===
            dpg.add_theme_color(dpg.mvThemeCol_Button, (30, 40, 60, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonHovered, (50, 200, 255, 220))
            dpg.add_theme_color(dpg.mvThemeCol_ButtonActive, (0, 255, 255, 255))
            dpg.add_theme_color(dpg.mvThemeCol_CheckMark, (0, 255, 255, 255))
            
            # === SLIDERS & GRABS ===
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrab, (0, 200, 255, 200))
            dpg.add_theme_color(dpg.mvThemeCol_SliderGrabActive, (0, 255, 255, 255))
            
            # === TABS & HEADERS ===
            dpg.add_theme_color(dpg.mvThemeCol_Tab, (15, 15, 25, 200))
            dpg.add_theme_color(dpg.mvThemeCol_TabHovered, (40, 100, 150, 220))
            dpg.add_theme_color(dpg.mvThemeCol_TabActive, (0, 180, 220, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TabUnfocused, (15, 15, 25, 150))
            dpg.add_theme_color(dpg.mvThemeCol_TabUnfocusedActive, (25, 80, 120, 200))
            dpg.add_theme_color(dpg.mvThemeCol_Header, (30, 30, 50, 200))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderHovered, (80, 180, 255, 220))
            dpg.add_theme_color(dpg.mvThemeCol_HeaderActive, (0, 220, 255, 255))
            
            # === SCROLLBAR ===
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarBg, (10, 10, 15, 150))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrab, (50, 100, 150, 200))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabHovered, (80, 150, 200, 230))
            dpg.add_theme_color(dpg.mvThemeCol_ScrollbarGrabActive, (0, 200, 255, 255))
            
            # === TITLE BAR ===
            dpg.add_theme_color(dpg.mvThemeCol_TitleBg, (10, 10, 15, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgActive, (0, 100, 150, 255))
            dpg.add_theme_color(dpg.mvThemeCol_TitleBgCollapsed, (10, 10, 15, 200))
            
            # === MODAL ===
            dpg.add_theme_color(dpg.mvThemeCol_ModalWindowDimBg, (0, 0, 0, 180))
            dpg.add_theme_color(dpg.mvThemeCol_BorderShadow, (0, 0, 0, 0))
            
            # === ROUNDING & SPACING ===
            dpg.add_theme_style(dpg.mvStyleVar_WindowRounding, 12)
            dpg.add_theme_style(dpg.mvStyleVar_ChildRounding, 10)
            dpg.add_theme_style(dpg.mvStyleVar_FrameRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_PopupRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_ScrollbarRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_GrabRounding, 6)
            dpg.add_theme_style(dpg.mvStyleVar_TabRounding, 8)
            dpg.add_theme_style(dpg.mvStyleVar_WindowBorderSize, 0)
            dpg.add_theme_style(dpg.mvStyleVar_FrameBorderSize, 1)
            dpg.add_theme_style(dpg.mvStyleVar_PopupBorderSize, 1)
            dpg.add_theme_style(dpg.mvStyleVar_ItemSpacing, 10, 8)
            dpg.add_theme_style(dpg.mvStyleVar_WindowPadding, 15, 15)
            dpg.add_theme_style(dpg.mvStyleVar_FramePadding, 8, 6)
            
    dpg.bind_theme(global_theme)

def setup_premium_gui():
    """Ultimate Premium External GUI - Redesigned for maximum wow factor"""
    apply_premium_ultimate_theme()
    
    # Make the default smaller but responsive: compact mode will stack panels
    WINDOW_WIDTH, WINDOW_HEIGHT = DEFAULT_GUI_WIDTH, DEFAULT_GUI_HEIGHT
    SIDEBAR_WIDTH = 220
    MAIN_CONTENT_WIDTH = WINDOW_WIDTH - SIDEBAR_WIDTH - 20
    # Adaptive column widths for panels
    LEFT_PANEL_WIDTH = int((MAIN_CONTENT_WIDTH - 40) * 0.6)
    RIGHT_PANEL_WIDTH = (MAIN_CONTENT_WIDTH - 40) - LEFT_PANEL_WIDTH
    COL_THIRD_WIDTH = int((MAIN_CONTENT_WIDTH - 60) / 3)
    STACK_LAYOUT = WINDOW_WIDTH < 1500
    
    with dpg.window(label="py1337 - Premium External", no_title_bar=True, no_resize=False, tag="Primary Window", 
                   width=WINDOW_WIDTH, height=WINDOW_HEIGHT, no_move=False):
        dpg.set_primary_window("Primary Window", True)
        
        with dpg.group(horizontal=True):
            # === PREMIUM SIDEBAR ===
            with dpg.child_window(width=SIDEBAR_WIDTH, height=WINDOW_HEIGHT - 70, border=True):
                dpg.add_spacer(height=15)
                
                # Logo/Branding
                dpg.add_text("py1337", color=(0, 200, 255, 255), wrap=SIDEBAR_WIDTH-20)
                dpg.add_text("@pyfeds", color=(100, 150, 200, 200), wrap=SIDEBAR_WIDTH-20)
                dpg.add_spacer(height=30)
                dpg.add_separator()
                dpg.add_spacer(height=15)
                
                # Navigation - Premium Style
                nav_items = [
                    ("AIMBOT", "aimbot_group"),
                    ("VISUALS", "visual_group"),
                    ("WORLD", "world_group"),
                    ("TRIGGER", "trigger_group"),
                    ("EXTRAS", "extra_group"),
                    ("CONFIG", "config_group"),
                    ("SETTINGS", "menu_group"),
                ]
                
                for label, group_tag in nav_items:
                    dpg.add_button(label=label, width=190, height=42, callback=change_tab, user_data=group_tag)
                    dpg.add_spacer(height=8)
                
                dpg.add_spacer(height=80)
                dpg.add_separator()
                dpg.add_spacer(height=10)
                
                # Status indicator
                dpg.add_text(" READY", color=(50, 255, 100, 255), wrap=SIDEBAR_WIDTH-20)
            
            dpg.add_spacer(width=15)
            
            # === MAIN CONTENT AREA ===
            with dpg.child_window(width=MAIN_CONTENT_WIDTH, height=WINDOW_HEIGHT - 70, border=False):
                
                # Helper function for premium section headers
                def premium_header(text, emoji=""):
                    dpg.add_text(f"{emoji} {text}", color=(0, 200, 255, 255))
                    dpg.add_separator()
                    dpg.add_spacer(height=10)

                # === AIMBOT TAB === 
                with dpg.group(tag="aimbot_group"):
                    premium_header("Aimbot System", "")
                    
                    if STACK_LAYOUT:
                        # Stacked layout (compact width) - left then right full width
                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=360, border=False):
                            dpg.add_text("General Settings", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_checkbox(label="Enable Aimbot", default_value=aimbot_enabled, callback=aimbot_callback, tag="aimbot_checkbox")
                            dpg.add_checkbox(label="Team Check", default_value=aimbot_ignoreteam, callback=aimbot_ignoreteam_callback)
                            dpg.add_checkbox(label="Dead Check", default_value=aimbot_ignoredead, callback=aimbot_ignoredead_callback)
                            dpg.add_spacer(height=12)
                            
                            dpg.add_text("Mode Selection:", color=(0, 180, 200, 255))
                            dpg.add_combo(["Camlock", "Mouse"], default_value="Camlock" if aimbot_type == "Memory" else aimbot_type, 
                                        tag="aimbot_option", callback=aimbot_mouse_callback)
                            dpg.add_combo(["Head", "HumanoidRootPart"], default_value="Head", tag="aimbot_hitpart_combo", callback=aimbot_hitpart_callback)
                            dpg.add_spacer(height=12)
                            
                            dpg.add_text("Keybind:", color=(0, 180, 200, 255))
                            dpg.add_button(label=f"[{get_key_name(aimbot_keybind)}]", tag="keybind_button", callback=keybind_callback)

                        dpg.add_spacer(height=8)

                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=300, border=False):
                            dpg.add_text("Advanced Options", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_checkbox(label="Prediction", default_value=aimbot_prediction_enabled, callback=aimbot_prediction_checkbox)
                            dpg.add_slider_float(label="Predict X", default_value=aimbot_prediction_x, min_value=-10.0, max_value=10.0, callback=prediction_x_callback)
                            dpg.add_slider_float(label="Predict Y", default_value=aimbot_prediction_y, min_value=-10.0, max_value=10.0, callback=prediction_y_callback)
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Smoothness", default_value=aimbot_smoothness_enabled, callback=aimbot_smoothness_callback)
                            dpg.add_slider_float(label="Smooth", default_value=aimbot_smoothness_value, min_value=1, max_value=100, callback=smoothness_value_callback)
                            dpg.add_slider_float(label="Sensitivity", default_value=aimbot_sens, min_value=0.1, max_value=2.0, callback=sens_value_callback)
                    else:
                        with dpg.group(horizontal=True):
                            # Left Panel
                            with dpg.child_window(width=LEFT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("General Settings", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_checkbox(label="Enable Aimbot", default_value=aimbot_enabled, callback=aimbot_callback, tag="aimbot_checkbox")
                                dpg.add_checkbox(label="Team Check", default_value=aimbot_ignoreteam, callback=aimbot_ignoreteam_callback)
                                dpg.add_checkbox(label="Dead Check", default_value=aimbot_ignoredead, callback=aimbot_ignoredead_callback)
                                dpg.add_spacer(height=12)
                                dpg.add_text("Mode Selection:", color=(0, 180, 200, 255))
                                dpg.add_combo(["Camlock", "Mouse"], default_value="Camlock" if aimbot_type == "Memory" else aimbot_type, 
                                            tag="aimbot_option", callback=aimbot_mouse_callback)
                                dpg.add_combo(["Head", "HumanoidRootPart"], default_value="Head", tag="aimbot_hitpart_combo", callback=aimbot_hitpart_callback)
                                dpg.add_spacer(height=12)
                                dpg.add_text("Keybind:", color=(0, 180, 200, 255))
                                dpg.add_button(label=f"[{get_key_name(aimbot_keybind)}]", tag="keybind_button", callback=keybind_callback)

                            dpg.add_spacer(width=15)

                            # Right Panel
                            with dpg.child_window(width=RIGHT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("Advanced Options", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_checkbox(label="Prediction", default_value=aimbot_prediction_enabled, callback=aimbot_prediction_checkbox)
                                dpg.add_slider_float(label="Predict X", default_value=aimbot_prediction_x, min_value=-10.0, max_value=10.0, callback=prediction_x_callback)
                                dpg.add_slider_float(label="Predict Y", default_value=aimbot_prediction_y, min_value=-10.0, max_value=10.0, callback=prediction_y_callback)
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Smoothness", default_value=aimbot_smoothness_enabled, callback=aimbot_smoothness_callback)
                                dpg.add_slider_float(label="Smooth", default_value=aimbot_smoothness_value, min_value=1, max_value=100, callback=smoothness_value_callback)
                                dpg.add_slider_float(label="Sensitivity", default_value=aimbot_sens, min_value=0.1, max_value=2.0, callback=sens_value_callback)

                # === VISUALS TAB ===
                with dpg.group(tag="visual_group", show=False):
                    premium_header("Visual Settings", "")
                    
                    if STACK_LAYOUT:
                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=420, border=False):
                            dpg.add_text("ESP Rendering", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_checkbox(label="Box ESP", default_value=global_show_box, callback=toggle_box)
                            dpg.add_checkbox(label="Skeleton ESP", default_value=global_show_skeleton, callback=toggle_skeleton)
                            dpg.add_checkbox(label="Names", default_value=global_show_name, callback=toggle_name)
                            dpg.add_checkbox(label="Health Bar", default_value=global_show_health, callback=toggle_health)
                            dpg.add_checkbox(label="Distance", default_value=global_show_distance, callback=toggle_distance)
                            dpg.add_slider_int(label="Thickness", default_value=global_esp_thickness, min_value=1, max_value=5, callback=esp_thickness_callback)
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Streamproof", default_value=streamproof_enabled, callback=toggle_streamproof)

                        dpg.add_spacer(height=8)

                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=420, border=False):
                            dpg.add_text("FOV & Overlay", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_checkbox(label="Show FOV Circle", default_value=fovtoggle, callback=fovtoggle_callback)
                            dpg.add_slider_float(label="FOV Size", default_value=aimbot_fov / 2, min_value=1.0, max_value=360.0, callback=setfov_callback)
                            dpg.add_combo(items=["circle", "polygon", "triangle", "square", "star"], default_value=shape, callback=shape_callback)
                            dpg.add_color_edit(label="FOV Color", default_value=[c/255 for c in fovColor], no_inputs=True, callback=fovColor_callback)
                            with dpg.group(horizontal=True):
                                dpg.add_checkbox(label="Fill")
                                dpg.add_checkbox(label="Glow")
                                dpg.add_checkbox(label="Outline")
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Crosshair", default_value=crosshair_enabled, callback=crosshair_toggle_callback)
                            dpg.add_color_edit(label="Crosshair Color", default_value=[c/255 for c in crosshair_color], no_inputs=True, callback=crosshair_color_callback)
                            dpg.add_slider_int(label="Size", default_value=crosshair_size, min_value=1, max_value=50, callback=crosshair_size_callback)
                    else:
                        with dpg.group(horizontal=True):
                            # ESP Panel
                            with dpg.child_window(width=LEFT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("ESP Rendering", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_checkbox(label="Box ESP", default_value=global_show_box, callback=toggle_box)
                                dpg.add_checkbox(label="Skeleton ESP", default_value=global_show_skeleton, callback=toggle_skeleton)
                                dpg.add_checkbox(label="Names", default_value=global_show_name, callback=toggle_name)
                                dpg.add_checkbox(label="Health Bar", default_value=global_show_health, callback=toggle_health)
                                dpg.add_checkbox(label="Distance", default_value=global_show_distance, callback=toggle_distance)
                                dpg.add_slider_int(label="Thickness", default_value=global_esp_thickness, min_value=1, max_value=5, callback=esp_thickness_callback)
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Streamproof", default_value=streamproof_enabled, callback=toggle_streamproof)

                            dpg.add_spacer(width=15)

                            # FOV & Crosshair
                            with dpg.child_window(width=RIGHT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("FOV & Overlay", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_checkbox(label="Show FOV Circle", default_value=fovtoggle, callback=fovtoggle_callback)
                                dpg.add_slider_float(label="FOV Size", default_value=aimbot_fov / 2, min_value=1.0, max_value=360.0, callback=setfov_callback)
                                dpg.add_combo(items=["circle", "polygon", "triangle", "square", "star"], default_value=shape, callback=shape_callback)
                                dpg.add_color_edit(label="FOV Color", default_value=[c/255 for c in fovColor], no_inputs=True, callback=fovColor_callback)
                                with dpg.group(horizontal=True):
                                    dpg.add_checkbox(label="Fill")
                                    dpg.add_checkbox(label="Glow")
                                    dpg.add_checkbox(label="Outline")
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Crosshair", default_value=crosshair_enabled, callback=crosshair_toggle_callback)
                                dpg.add_color_edit(label="Crosshair Color", default_value=[c/255 for c in crosshair_color], no_inputs=True, callback=crosshair_color_callback)
                                dpg.add_slider_int(label="Size", default_value=crosshair_size, min_value=1, max_value=50, callback=crosshair_size_callback)

                # === WORLD EDITOR TAB ===
                with dpg.group(tag="world_group", show=False):
                    premium_header("World Environment Editor", "")
                    
                    if STACK_LAYOUT:
                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=420, border=False):
                            dpg.add_text("Lighting & Ambience", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_button(label=" Full Bright (Instant)", callback=full_bright_callback)
                            dpg.add_spacer(height=10)
                            dpg.add_checkbox(label="Custom Ambient", default_value=world_ambient_enabled, callback=toggle_world_ambient)
                            dpg.add_color_edit(label="Ambient Color", default_value=[c/255 for c in world_ambient_color], no_inputs=True, callback=update_ambient_color)
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Custom Fog", default_value=world_fog_enabled, callback=toggle_world_fog)
                            dpg.add_slider_float(label="Fog Start", default_value=world_fog_start, min_value=0, max_value=1000, callback=update_fog_start)
                            dpg.add_slider_float(label="Fog End", default_value=world_fog_end, min_value=0, max_value=10000, callback=update_fog_end)
                            dpg.add_color_edit(label="Fog Color", default_value=[c/255 for c in world_fog_color], no_inputs=True, callback=update_fog_color)
                            dpg.add_checkbox(label="Disco Fog", default_value=world_disco_fog, callback=toggle_disco_fog)

                        dpg.add_spacer(height=8)

                        with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=420, border=False):
                            dpg.add_text("Map Cleanup & Physics", color=(0, 200, 255, 255))
                            dpg.add_separator()
                            dpg.add_spacer(height=8)
                            dpg.add_text("Hide Map Objects:", color=(150, 200, 255, 200))
                            dpg.add_button(label=" Hide Doors", callback=delete_doors_callback)
                            dpg.add_button(label=" Hide Seats", callback=delete_seats_callback)
                            dpg.add_button(label=" Hide Trees", callback=delete_trees_callback)
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Custom Gravity", default_value=world_gravity_enabled, callback=toggle_world_gravity)
                            dpg.add_slider_float(label="Gravity Value", default_value=world_gravity_value, min_value=0, max_value=200, callback=update_world_gravity)
                            dpg.add_spacer(height=12)
                            dpg.add_checkbox(label="Black Sky", default_value=world_black_sky, callback=toggle_black_sky)
                            dpg.add_checkbox(label="Infinite Zoom", default_value=world_infinite_zoom, callback=toggle_infinite_zoom)
                    else:
                        with dpg.group(horizontal=True):
                            # Lighting Panel
                            with dpg.child_window(width=LEFT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("Lighting & Ambience", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_button(label=" Full Bright (Instant)", callback=full_bright_callback)
                                dpg.add_spacer(height=10)
                                dpg.add_checkbox(label="Custom Ambient", default_value=world_ambient_enabled, callback=toggle_world_ambient)
                                dpg.add_color_edit(label="Ambient Color", default_value=[c/255 for c in world_ambient_color], no_inputs=True, callback=update_ambient_color)
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Custom Fog", default_value=world_fog_enabled, callback=toggle_world_fog)
                                dpg.add_slider_float(label="Fog Start", default_value=world_fog_start, min_value=0, max_value=1000, callback=update_fog_start)
                                dpg.add_slider_float(label="Fog End", default_value=world_fog_end, min_value=0, max_value=10000, callback=update_fog_end)
                                dpg.add_color_edit(label="Fog Color", default_value=[c/255 for c in world_fog_color], no_inputs=True, callback=update_fog_color)
                                dpg.add_checkbox(label="Disco Fog", default_value=world_disco_fog, callback=toggle_disco_fog)

                            dpg.add_spacer(width=15)

                            # Physics & Cleanup
                            with dpg.child_window(width=RIGHT_PANEL_WIDTH, height=500, border=False):
                                dpg.add_text("Map Cleanup & Physics", color=(0, 200, 255, 255))
                                dpg.add_separator()
                                dpg.add_spacer(height=8)
                                dpg.add_text("Hide Map Objects:", color=(150, 200, 255, 200))
                                dpg.add_button(label=" Hide Doors", callback=delete_doors_callback)
                                dpg.add_button(label=" Hide Seats", callback=delete_seats_callback)
                                dpg.add_button(label=" Hide Trees", callback=delete_trees_callback)
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Custom Gravity", default_value=world_gravity_enabled, callback=toggle_world_gravity)
                                dpg.add_slider_float(label="Gravity Value", default_value=world_gravity_value, min_value=0, max_value=200, callback=update_world_gravity)
                                dpg.add_spacer(height=12)
                                dpg.add_checkbox(label="Black Sky", default_value=world_black_sky, callback=toggle_black_sky)
                                dpg.add_checkbox(label="Infinite Zoom", default_value=world_infinite_zoom, callback=toggle_infinite_zoom)

                # === EXTRAS TAB ===
                with dpg.group(tag="extra_group", show=False):
                    premium_header("Extra Features", "")
                    
                    with dpg.child_window(width=MAIN_CONTENT_WIDTH - 40, height=500, border=False):
                        dpg.add_text(" Movement & Combat", color=(0, 200, 255, 255))
                        dpg.add_separator()
                        dpg.add_spacer(height=10)
                        
                        if STACK_LAYOUT:
                            with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=260, border=False):
                                dpg.add_text("Movement", color=(100, 200, 255, 200))
                                dpg.add_separator()
                                dpg.add_checkbox(label="Enable Fly", default_value=fly_enabled, callback=fly_callback)
                                dpg.add_slider_float(label="Fly Speed", default_value=fly_speed, min_value=1.0, max_value=100.0, callback=fly_speed_callback)
                                dpg.add_button(label=f"Fly Key: {get_key_name(fly_keybind)}", callback=fly_keybind_callback)
                                dpg.add_checkbox(label="Noclip", default_value=extra_noclip, callback=toggle_extra_noclip)
                                dpg.add_checkbox(label="Float", default_value=extra_float, callback=toggle_extra_float)

                            dpg.add_spacer(height=8)

                            with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=180, border=False):
                                dpg.add_text("Combat", color=(100, 200, 255, 200))
                                dpg.add_separator()
                                dpg.add_checkbox(label="No Spread", default_value=no_spread_enabled, callback=no_spread_callback)
                                dpg.add_checkbox(label="Spam 'E'", default_value=extra_spam_e, callback=toggle_extra_spam_e)

                            dpg.add_spacer(height=8)

                            with dpg.child_window(width=MAIN_CONTENT_WIDTH - 20, height=220, border=False):
                                dpg.add_text("Triggerbot", color=(100, 200, 255, 200))
                                dpg.add_separator()
                                dpg.add_checkbox(label="Enable", default_value=triggerbot_enabled, callback=triggerbot_enable_callback)
                                dpg.add_button(label=f"Key: {get_key_name(triggerbot_key)}", callback=triggerbot_key_callback)
                                dpg.add_slider_float(label="Reaction", default_value=triggerbot_delay_reaction, min_value=0, max_value=500, callback=triggerbot_reaction_callback)
                                dpg.add_slider_float(label="Shot Delay", default_value=triggerbot_delay_shot, min_value=0, max_value=500, callback=triggerbot_shot_callback)
                        else:
                            with dpg.group(horizontal=True):
                                with dpg.child_window(width=(MAIN_CONTENT_WIDTH - 60) // 3, height=400, border=False):
                                    dpg.add_text("Movement", color=(100, 200, 255, 200))
                                    dpg.add_separator()
                                    dpg.add_checkbox(label="Enable Fly", default_value=fly_enabled, callback=fly_callback)
                                    dpg.add_slider_float(label="Fly Speed", default_value=fly_speed, min_value=1.0, max_value=100.0, callback=fly_speed_callback)
                                    dpg.add_button(label=f"Fly Key: {get_key_name(fly_keybind)}", callback=fly_keybind_callback)
                                    dpg.add_checkbox(label="Noclip", default_value=extra_noclip, callback=toggle_extra_noclip)
                                    dpg.add_checkbox(label="Float", default_value=extra_float, callback=toggle_extra_float)

                                dpg.add_spacer(width=10)

                                with dpg.child_window(width=(MAIN_CONTENT_WIDTH - 60) // 3, height=400, border=False):
                                    dpg.add_text("Combat", color=(100, 200, 255, 200))
                                    dpg.add_separator()
                                    dpg.add_checkbox(label="No Spread", default_value=no_spread_enabled, callback=no_spread_callback)
                                    dpg.add_checkbox(label="Spam 'E'", default_value=extra_spam_e, callback=toggle_extra_spam_e)

                                dpg.add_spacer(width=10)

                                with dpg.child_window(width=(MAIN_CONTENT_WIDTH - 60) // 3, height=400, border=False):
                                    dpg.add_text("Triggerbot", color=(100, 200, 255, 200))
                                    dpg.add_separator()
                                    dpg.add_checkbox(label="Enable", default_value=triggerbot_enabled, callback=triggerbot_enable_callback)
                                    dpg.add_button(label=f"Key: {get_key_name(triggerbot_key)}", callback=triggerbot_key_callback)
                                    dpg.add_slider_float(label="Reaction", default_value=triggerbot_delay_reaction, min_value=0, max_value=500, callback=triggerbot_reaction_callback)
                                    dpg.add_slider_float(label="Shot Delay", default_value=triggerbot_delay_shot, min_value=0, max_value=500, callback=triggerbot_shot_callback)

                # === CONFIG TAB ===
                # === TRIGGER TAB (Triggerbot + Silent Aim) ===
                with dpg.group(tag="trigger_group", show=False):
                    premium_header("Trigger & Silent", "")
                    with dpg.child_window(width=MAIN_CONTENT_WIDTH - 40, height=420, border=False):
                        dpg.add_text("Triggerbot", color=(0,200,255,255))
                        dpg.add_separator()
                        dpg.add_spacer(height=6)
                        dpg.add_checkbox(label="Enable Triggerbot", default_value=triggerbot_enabled, callback=triggerbot_enable_callback, tag="triggerbot_checkbox")
                        dpg.add_button(label=f"Key: {get_key_name(triggerbot_key)}", tag="triggerbot_shoot_key_button", callback=triggerbot_key_callback)
                        dpg.add_slider_float(label="Reaction (ms)", default_value=triggerbot_delay_reaction, min_value=0, max_value=500, callback=triggerbot_reaction_callback)
                        dpg.add_slider_float(label="Shot Delay (ms)", default_value=triggerbot_delay_shot, min_value=0, max_value=500, callback=triggerbot_shot_callback)
                        dpg.add_spacer(height=12)
                        dpg.add_text("Silent Aim", color=(0,200,255,255))
                        dpg.add_separator()
                        dpg.add_spacer(height=6)
                        dpg.add_checkbox(label="Enable Silent Aim", default_value=silent_aim_enabled, callback=silent_aim_callback, tag="silent_aim_checkbox")
                        dpg.add_button(label=f"Key: {get_key_name(silent_aim_key)}", tag="silent_aim_key_button", callback=silent_aim_key_callback)
                        dpg.add_slider_int(label="Silent Aim FOV", default_value=silent_aim_fov, min_value=10, max_value=1000, callback=silent_aim_fov_callback)
                        dpg.add_slider_int(label="Hitchance (%)", default_value=silent_aim_hitchance, min_value=0, max_value=100, callback=silent_aim_hitchance_callback)
                        dpg.add_checkbox(label="Use Prediction", default_value=silent_aim_smart, callback=silent_aim_smart_callback)
                        dpg.add_slider_float(label="Prediction X", default_value=silent_aim_prediction_x, min_value=0.0, max_value=2.0, callback=prediction_x_silent_callback)
                        dpg.add_slider_float(label="Prediction Y", default_value=silent_aim_prediction_y, min_value=0.0, max_value=2.0, callback=prediction_y_silent_callback)

                with dpg.group(tag="config_group", show=False):
                    premium_header("Configuration Manager", "")
                    
                    with dpg.child_window(width=MAIN_CONTENT_WIDTH - 40, height=500, border=False):
                        dpg.add_text("Configuration Profiles", color=(0, 200, 255, 255))
                        dpg.add_separator()
                        dpg.add_spacer(height=10)
                        
                        dpg.add_combo(label="Select Profile", tag="config_dropdown", items=get_config_files())
                        dpg.add_spacer(height=10)

                        with dpg.group(horizontal=True):
                            dpg.add_button(label=" Load Config", callback=load_selected_config)
                            dpg.add_button(label=" Save Config", callback=save_selected_config)
                            dpg.add_button(label=" Open Folder", callback=open_config_folder)
                        
                        dpg.add_spacer(height=20)
                        dpg.add_separator()
                        dpg.add_spacer(height=15)
                        
                        dpg.add_text("Create New Profile:", color=(0, 200, 255, 200))
                        dpg.add_input_text(label="Profile Name", tag="new_config_name_input")
                        dpg.add_button(label="Create Profile", callback=create_config_callback)

                # === SETTINGS TAB ===
                with dpg.group(tag="menu_group", show=False):
                    premium_header("System Settings", "")
                    
                    with dpg.child_window(width=MAIN_CONTENT_WIDTH - 40, height=500, border=False):
                        dpg.add_text("Global Keybinds", color=(0, 200, 255, 255))
                        dpg.add_separator()
                        dpg.add_spacer(height=10)
                        
                        dpg.add_button(label=f"Menu Toggle: {get_key_name(triggerbot_keybind)}", tag="triggerbot_keybind_button", callback=triggerbot_keybind_callback)
                        dpg.add_button(label=" Re-Attach to Game", callback=init)
                        
                        dpg.add_spacer(height=20)
                        dpg.add_separator()
                        dpg.add_spacer(height=15)
                        
                        dpg.add_text("Overlay FPS Limit:", color=(0, 200, 255, 200))
                        dpg.add_slider_int(label="FPS", default_value=overlay_fps, min_value=1, max_value=244, callback=update_overlay_fps)

if __name__ == "__main__":
    if v == "Windows 10":
     threading.Thread(target=run_galaxy_background, daemon=True).start()
    initialize_controller()
    dpg.create_context()
    setup_premium_gui()
    drag_pos = None
    def mouse_drag_callback(sender, app_data):
        global drag_pos
        if drag_pos:
            new_pos = dpg.get_viewport_pos()
            delta = [app_data[1], app_data[2]]
            dpg.set_viewport_pos([new_pos[0] + delta[0], new_pos[1] + delta[1]])
    def mouse_down_callback(sender, app_data):
        global drag_pos
        if app_data[0] == 0:
            if dpg.does_item_exist("Primary Window") and dpg.is_item_hovered("Primary Window"):
                drag_pos = True
    def mouse_up_callback(sender, app_data):
        global drag_pos
        drag_pos = None
    os.system("cls")
    os.system("title Py1337 - Home")
    inject_callback()
    time.sleep(1)
    
    # Apply premium ultimate theme
    apply_premium_ultimate_theme()

    if theme == "Pink":
        apply_purpleish_pink_theme()
        keybind_bg_color = [35, 35, 45]
        keybind_line_color = [180, 100, 255]
        keybind_text_color = [220, 220, 230]
    elif theme == "White":
        apply_white_and_grey_theme()
        keybind_bg_color = [220, 220, 220]
        keybind_line_color = [140, 140, 140]
        keybind_text_color = [20, 20, 20]
    elif theme == "Black":
        apply_black_and_white_theme()
        keybind_bg_color = [30, 30, 30]
        keybind_line_color = [80, 80, 80]
        keybind_text_color = [240, 240, 240]
    elif theme == "Blue":
        apply_blueish_cyan_theme()
        keybind_bg_color = [35, 45, 55]
        keybind_line_color = [100, 150, 200]
        keybind_text_color = [220, 230, 240]
    ui_visible = True
    last_toggle_time = 0
    toggle_debounce_delay = 0.2
    def toggle_ui_visibility():
        global ui_visible, last_toggle_time
        current_time = time.time()
        if current_time - last_toggle_time < toggle_debounce_delay:
            return
        last_toggle_time = current_time
        ui_visible = not ui_visible
        if ui_visible:
            # Show the window
            dpg.set_viewport_always_top(True)
            hwnd = windll.user32.FindWindowW(None, "Py1337")
            if hwnd:
                windll.user32.ShowWindow(hwnd, 1)  # SW_SHOW
                windll.user32.SetWindowPos(hwnd, -1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
        else:
            # Hide the window
            hwnd = windll.user32.FindWindowW(None, "Py1337")
            if hwnd:
                windll.user32.ShowWindow(hwnd, 0)  # SW_HIDE
                windll.user32.SetWindowPos(hwnd, 1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
            dpg.set_viewport_always_top(False)
            # Bring Roblox to front
            roblox_hwnd = windll.user32.FindWindowW(None, "Roblox")
            if roblox_hwnd:
                windll.user32.SetWindowPos(roblox_hwnd, -1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
        if controller:
            controller.visibility_changed.emit(ui_visible)
        time.sleep(0.05)
    def del_key_listener():
        while True:
            if ui_visible:
                hwnd = windll.user32.FindWindowW(None, "Py1337")
                if hwnd:
                    windll.user32.SetWindowPos(hwnd, -1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
            else:
                dpg.set_viewport_always_top(False)
                hwnd = windll.user32.FindWindowW(None, "Py1337")
                if hwnd:
                    windll.user32.SetWindowPos(hwnd, 1, 0, 0, 0, 0, 0x0001 | 0x0002 | 0x0040)
            if is_key_pressed(triggerbot_keybind):
                toggle_ui_visibility()
            time.sleep(0.1)
    # Create viewport using the default GUI size so the visible window matches the layout width
    vpw = min(DEFAULT_GUI_WIDTH, swidth)
    vph = min(DEFAULT_GUI_HEIGHT, sheight)
    dpg.create_viewport(title="Py1337 - Amidone Remake", decorated=False, resizable=True, width=vpw, height=vph, always_on_top=True, small_icon="logo.ico", large_icon="logo.ico")
    with dpg.handler_registry():
        dpg.add_mouse_down_handler(callback=mouse_down_callback)
        dpg.add_mouse_drag_handler(callback=mouse_drag_callback)
        dpg.add_mouse_release_handler(callback=mouse_up_callback)
    dpg.set_viewport_pos([410, 150])
    dpg.setup_dearpygui()
    # dpg.set_primary_window("Primary Window", True)
    threading.Thread(target=del_key_listener, daemon=True).start()
    threading.Thread(target=aimbotLoop2d, daemon=True).start()
    threading.Thread(target=aimbotLoop, daemon=True).start()
    threading.Thread(target=clear_cache_periodically, daemon=True).start()
    threading.Thread(target=start,daemon=True).start()
    threading.Thread(target=checkconfigidk,daemon=True).start()
    threading.Thread(target=triggerbot_loop, daemon=True).start()
    threading.Thread(target=triggerbot_key_listener, daemon=True).start()
    threading.Thread(target=silent_aim_loop, daemon=True).start()
    threading.Thread(target=silent_aim_key_listener, daemon=True).start()
    threading.Thread(target=silent_aim_toggle_listener, daemon=True).start()
    threading.Thread(target=chams_loop, daemon=True).start()
    threading.Thread(target=rapid_fire_loop, daemon=True).start()
    threading.Thread(target=rapid_fire_key_listener, daemon=True).start()
    threading.Thread(target=world_loop, daemon=True).start()
    threading.Thread(target=extras_loop, daemon=True).start()
    dpg.set_viewport_always_top(True)
    fly_thread = FlyThread(pm, baseAddr, offsets)
    fly_thread.start()
    no_spread_thread = NoSpreadThread(pm, baseAddr, offsets)
    no_spread_thread.start()
    dpg.show_viewport()
    hwnd = windll.user32.FindWindowW(None, "Py1337")
    if hwnd:
        GWL_EXSTYLE = -20
        WS_EX_TOOLWINDOW = 0x00000080
        SWP_FRAMECHANGED = 0x0020
        SWP_NOMOVE = 0x0002
        SWP_NOSIZE = 0x0001
        SWP_NOZORDER = 0x0004
        ex_style = windll.user32.GetWindowLongW(hwnd, GWL_EXSTYLE)
        new_ex_style = ex_style | WS_EX_TOOLWINDOW
        windll.user32.SetWindowLongW(hwnd, GWL_EXSTYLE, new_ex_style)
        windll.user32.SetWindowPos(hwnd, 0, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED)
    dpg.start_dearpygui()
    dpg.destroy_context()
